
===== pytest (backend) =====

EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE                                       [100%]
==================================== ERRORS ====================================
__________ ERROR at setup of test_list_lots_filters_by_warehouse_code __________

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

fixturedef = <FixtureDef argname='setup_database' scope='session' baseid='tests'>
request = <SubRequest 'setup_database' for <Function test_list_lots_filters_by_warehouse_code>>

    @pytest.hookimpl(wrapper=True)
    def pytest_fixture_setup(fixturedef: FixtureDef, request) -> object | None:
        asyncio_mode = _get_asyncio_mode(request.config)
        if not _is_asyncio_fixture_function(fixturedef.func):
            if asyncio_mode == Mode.STRICT:
                # Ignore async fixtures without explicit asyncio mark in strict mode
                # This applies to pytest_trio fixtures, for example
                return (yield)
            if not _is_coroutine_or_asyncgen(fixturedef.func):
>               return (yield)
                        ^^^^^

/usr/local/lib/python3.12/site-packages/pytest_asyncio/plugin.py:735: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/conftest.py:30: in setup_database
    Base.metadata.create_all(bind=engine)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
---------------------------- Captured stdout setup -----------------------------
2025-11-10 17:59:03,589 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2025-11-10 17:59:03,589 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("forecasts")
PRAGMA main.table_info("forecasts")
2025-11-10 17:59:03,589 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,590 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("forecasts")
PRAGMA temp.table_info("forecasts")
2025-11-10 17:59:03,590 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,590 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("lots")
PRAGMA main.table_info("lots")
2025-11-10 17:59:03,590 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,590 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("lots")
PRAGMA temp.table_info("lots")
2025-11-10 17:59:03,591 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,591 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("lot_current_stock")
PRAGMA main.table_info("lot_current_stock")
2025-11-10 17:59:03,591 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,591 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("lot_current_stock")
PRAGMA temp.table_info("lot_current_stock")
2025-11-10 17:59:03,591 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,591 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("stock_movements")
PRAGMA main.table_info("stock_movements")
2025-11-10 17:59:03,591 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,591 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("stock_movements")
PRAGMA temp.table_info("stock_movements")
2025-11-10 17:59:03,591 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,591 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("expiry_rules")
PRAGMA main.table_info("expiry_rules")
2025-11-10 17:59:03,592 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,592 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("expiry_rules")
PRAGMA temp.table_info("expiry_rules")
2025-11-10 17:59:03,592 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,592 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("inbound_submissions")
PRAGMA main.table_info("inbound_submissions")
2025-11-10 17:59:03,592 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,592 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("inbound_submissions")
PRAGMA temp.table_info("inbound_submissions")
2025-11-10 17:59:03,592 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,592 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("sap_sync_logs")
PRAGMA main.table_info("sap_sync_logs")
2025-11-10 17:59:03,592 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,593 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("sap_sync_logs")
PRAGMA temp.table_info("sap_sync_logs")
2025-11-10 17:59:03,593 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,593 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("warehouses")
PRAGMA main.table_info("warehouses")
2025-11-10 17:59:03,593 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,593 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("warehouses")
PRAGMA temp.table_info("warehouses")
2025-11-10 17:59:03,593 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,593 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("suppliers")
PRAGMA main.table_info("suppliers")
2025-11-10 17:59:03,593 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,593 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("suppliers")
PRAGMA temp.table_info("suppliers")
2025-11-10 17:59:03,593 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,594 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("customers")
PRAGMA main.table_info("customers")
2025-11-10 17:59:03,594 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,594 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("customers")
PRAGMA temp.table_info("customers")
2025-11-10 17:59:03,594 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,594 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("delivery_places")
PRAGMA main.table_info("delivery_places")
2025-11-10 17:59:03,594 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,594 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("delivery_places")
PRAGMA temp.table_info("delivery_places")
2025-11-10 17:59:03,594 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,594 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("products")
PRAGMA main.table_info("products")
2025-11-10 17:59:03,595 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,595 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("products")
PRAGMA temp.table_info("products")
2025-11-10 17:59:03,595 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,595 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("unit_conversions")
PRAGMA main.table_info("unit_conversions")
2025-11-10 17:59:03,595 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,595 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("unit_conversions")
PRAGMA temp.table_info("unit_conversions")
2025-11-10 17:59:03,595 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,595 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("orders")
PRAGMA main.table_info("orders")
2025-11-10 17:59:03,595 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,595 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("orders")
PRAGMA temp.table_info("orders")
2025-11-10 17:59:03,596 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,596 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("order_lines")
PRAGMA main.table_info("order_lines")
2025-11-10 17:59:03,596 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,596 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("order_lines")
PRAGMA temp.table_info("order_lines")
2025-11-10 17:59:03,596 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,596 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("order_line_warehouse_allocation")
PRAGMA main.table_info("order_line_warehouse_allocation")
2025-11-10 17:59:03,596 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,596 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("order_line_warehouse_allocation")
PRAGMA temp.table_info("order_line_warehouse_allocation")
2025-11-10 17:59:03,596 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,597 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("allocations")
PRAGMA main.table_info("allocations")
2025-11-10 17:59:03,597 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,597 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("allocations")
PRAGMA temp.table_info("allocations")
2025-11-10 17:59:03,597 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,597 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("purchase_requests")
PRAGMA main.table_info("purchase_requests")
2025-11-10 17:59:03,597 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,597 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("purchase_requests")
PRAGMA temp.table_info("purchase_requests")
2025-11-10 17:59:03,597 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-11-10 17:59:03,598 INFO sqlalchemy.engine.Engine 
CREATE TABLE lot_current_stock (
	lot_id INTEGER NOT NULL, 
	product_id INTEGER NOT NULL, 
	warehouse_id INTEGER NOT NULL, 
	current_quantity NUMERIC(15, 4) NOT NULL, 
	last_updated DATETIME, 
	PRIMARY KEY (lot_id, product_id, warehouse_id)
)



CREATE TABLE lot_current_stock (
	lot_id INTEGER NOT NULL, 
	product_id INTEGER NOT NULL, 
	warehouse_id INTEGER NOT NULL, 
	current_quantity NUMERIC(15, 4) NOT NULL, 
	last_updated DATETIME, 
	PRIMARY KEY (lot_id, product_id, warehouse_id)
)


2025-11-10 17:59:03,598 INFO sqlalchemy.engine.Engine [no key 0.00015s] ()
[no key 0.00015s] ()
2025-11-10 17:59:03,606 INFO sqlalchemy.engine.Engine 
CREATE TABLE inbound_submissions (
	id INTEGER NOT NULL, 
	submission_id TEXT, 
	source_uri TEXT, 
	source VARCHAR(20) DEFAULT 'ocr' NOT NULL, 
	operator TEXT, 
	submission_date DATETIME, 
	status TEXT, 
	total_records INTEGER, 
	processed_records INTEGER, 
	failed_records INTEGER, 
	skipped_records INTEGER, 
	error_details TEXT, 
	created_at DATETIME, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_by VARCHAR(50), 
	updated_by VARCHAR(50), 
	deleted_at DATETIME, 
	revision INTEGER DEFAULT 1 NOT NULL, 
	PRIMARY KEY (id), 
	CONSTRAINT ocr_submissions_submission_id_key UNIQUE (submission_id), 
	CONSTRAINT ck_inbound_submissions_source CHECK (source IN ('ocr','manual','edi'))
)



CREATE TABLE inbound_submissions (
	id INTEGER NOT NULL, 
	submission_id TEXT, 
	source_uri TEXT, 
	source VARCHAR(20) DEFAULT 'ocr' NOT NULL, 
	operator TEXT, 
	submission_date DATETIME, 
	status TEXT, 
	total_records INTEGER, 
	processed_records INTEGER, 
	failed_records INTEGER, 
	skipped_records INTEGER, 
	error_details TEXT, 
	created_at DATETIME, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_by VARCHAR(50), 
	updated_by VARCHAR(50), 
	deleted_at DATETIME, 
	revision INTEGER DEFAULT 1 NOT NULL, 
	PRIMARY KEY (id), 
	CONSTRAINT ocr_submissions_submission_id_key UNIQUE (submission_id), 
	CONSTRAINT ck_inbound_submissions_source CHECK (source IN ('ocr','manual','edi'))
)


2025-11-10 17:59:03,606 INFO sqlalchemy.engine.Engine [no key 0.00016s] ()
[no key 0.00016s] ()
2025-11-10 17:59:03,613 INFO sqlalchemy.engine.Engine 
CREATE TABLE warehouses (
	id INTEGER NOT NULL, 
	warehouse_code TEXT NOT NULL, 
	warehouse_name TEXT NOT NULL, 
	address TEXT, 
	is_active BOOLEAN DEFAULT true NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_by VARCHAR(50), 
	updated_by VARCHAR(50), 
	deleted_at DATETIME, 
	revision INTEGER DEFAULT 1 NOT NULL, 
	PRIMARY KEY (id), 
	CONSTRAINT uq_warehouses_warehouse_code UNIQUE (warehouse_code)
)



CREATE TABLE warehouses (
	id INTEGER NOT NULL, 
	warehouse_code TEXT NOT NULL, 
	warehouse_name TEXT NOT NULL, 
	address TEXT, 
	is_active BOOLEAN DEFAULT true NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_by VARCHAR(50), 
	updated_by VARCHAR(50), 
	deleted_at DATETIME, 
	revision INTEGER DEFAULT 1 NOT NULL, 
	PRIMARY KEY (id), 
	CONSTRAINT uq_warehouses_warehouse_code UNIQUE (warehouse_code)
)


2025-11-10 17:59:03,613 INFO sqlalchemy.engine.Engine [no key 0.00017s] ()
[no key 0.00017s] ()
2025-11-10 17:59:03,620 INFO sqlalchemy.engine.Engine CREATE UNIQUE INDEX uq_warehouses_id ON warehouses (id)
CREATE UNIQUE INDEX uq_warehouses_id ON warehouses (id)
2025-11-10 17:59:03,620 INFO sqlalchemy.engine.Engine [no key 0.00016s] ()
[no key 0.00016s] ()
2025-11-10 17:59:03,625 INFO sqlalchemy.engine.Engine 
CREATE TABLE suppliers (
	id INTEGER NOT NULL, 
	supplier_code TEXT NOT NULL, 
	supplier_name TEXT NOT NULL, 
	address TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_by VARCHAR(50), 
	updated_by VARCHAR(50), 
	deleted_at DATETIME, 
	revision INTEGER DEFAULT 1 NOT NULL, 
	PRIMARY KEY (id), 
	CONSTRAINT uq_suppliers_supplier_code UNIQUE (supplier_code)
)



CREATE TABLE suppliers (
	id INTEGER NOT NULL, 
	supplier_code TEXT NOT NULL, 
	supplier_name TEXT NOT NULL, 
	address TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_by VARCHAR(50), 
	updated_by VARCHAR(50), 
	deleted_at DATETIME, 
	revision INTEGER DEFAULT 1 NOT NULL, 
	PRIMARY KEY (id), 
	CONSTRAINT uq_suppliers_supplier_code UNIQUE (supplier_code)
)


2025-11-10 17:59:03,626 INFO sqlalchemy.engine.Engine [no key 0.00016s] ()
[no key 0.00016s] ()
2025-11-10 17:59:03,632 INFO sqlalchemy.engine.Engine CREATE INDEX ix_suppliers_supplier_code ON suppliers (supplier_code)
CREATE INDEX ix_suppliers_supplier_code ON suppliers (supplier_code)
2025-11-10 17:59:03,632 INFO sqlalchemy.engine.Engine [no key 0.00016s] ()
[no key 0.00016s] ()
2025-11-10 17:59:03,639 INFO sqlalchemy.engine.Engine 
CREATE TABLE customers (
	id INTEGER NOT NULL, 
	customer_code TEXT NOT NULL, 
	customer_name TEXT NOT NULL, 
	address TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_by VARCHAR(50), 
	updated_by VARCHAR(50), 
	deleted_at DATETIME, 
	revision INTEGER DEFAULT 1 NOT NULL, 
	PRIMARY KEY (id), 
	CONSTRAINT uq_customers_customer_code UNIQUE (customer_code)
)



CREATE TABLE customers (
	id INTEGER NOT NULL, 
	customer_code TEXT NOT NULL, 
	customer_name TEXT NOT NULL, 
	address TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_by VARCHAR(50), 
	updated_by VARCHAR(50), 
	deleted_at DATETIME, 
	revision INTEGER DEFAULT 1 NOT NULL, 
	PRIMARY KEY (id), 
	CONSTRAINT uq_customers_customer_code UNIQUE (customer_code)
)


2025-11-10 17:59:03,639 INFO sqlalchemy.engine.Engine [no key 0.00017s] ()
[no key 0.00017s] ()
2025-11-10 17:59:03,645 INFO sqlalchemy.engine.Engine CREATE INDEX ix_customers_customer_code ON customers (customer_code)
CREATE INDEX ix_customers_customer_code ON customers (customer_code)
2025-11-10 17:59:03,646 INFO sqlalchemy.engine.Engine [no key 0.00019s] ()
[no key 0.00019s] ()
2025-11-10 17:59:03,652 INFO sqlalchemy.engine.Engine 
CREATE TABLE delivery_places (
	id INTEGER NOT NULL, 
	delivery_place_code VARCHAR NOT NULL, 
	delivery_place_name VARCHAR NOT NULL, 
	address VARCHAR, 
	postal_code VARCHAR, 
	is_active BOOLEAN DEFAULT true NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_by VARCHAR(50), 
	updated_by VARCHAR(50), 
	deleted_at DATETIME, 
	revision INTEGER DEFAULT 1 NOT NULL, 
	PRIMARY KEY (id), 
	CONSTRAINT uq_delivery_places_code UNIQUE (delivery_place_code)
)



CREATE TABLE delivery_places (
	id INTEGER NOT NULL, 
	delivery_place_code VARCHAR NOT NULL, 
	delivery_place_name VARCHAR NOT NULL, 
	address VARCHAR, 
	postal_code VARCHAR, 
	is_active BOOLEAN DEFAULT true NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_by VARCHAR(50), 
	updated_by VARCHAR(50), 
	deleted_at DATETIME, 
	revision INTEGER DEFAULT 1 NOT NULL, 
	PRIMARY KEY (id), 
	CONSTRAINT uq_delivery_places_code UNIQUE (delivery_place_code)
)


2025-11-10 17:59:03,652 INFO sqlalchemy.engine.Engine [no key 0.00016s] ()
[no key 0.00016s] ()
2025-11-10 17:59:03,659 INFO sqlalchemy.engine.Engine CREATE INDEX ix_delivery_places_delivery_place_code ON delivery_places (delivery_place_code)
CREATE INDEX ix_delivery_places_delivery_place_code ON delivery_places (delivery_place_code)
2025-11-10 17:59:03,659 INFO sqlalchemy.engine.Engine [no key 0.00016s] ()
[no key 0.00016s] ()
2025-11-10 17:59:03,666 INFO sqlalchemy.engine.Engine 
CREATE TABLE products (
	id INTEGER NOT NULL, 
	product_code TEXT NOT NULL, 
	product_name TEXT NOT NULL, 
	customer_part_no TEXT, 
	maker_item_code TEXT, 
	internal_unit TEXT NOT NULL, 
	assemble_div TEXT, 
	next_div TEXT, 
	shelf_life_days INTEGER, 
	requires_lot_number INTEGER, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_by VARCHAR(50), 
	updated_by VARCHAR(50), 
	deleted_at DATETIME, 
	revision INTEGER DEFAULT 1 NOT NULL, 
	base_unit VARCHAR(10) DEFAULT 'EA' NOT NULL, 
	packaging_qty NUMERIC(10, 2) DEFAULT 1 NOT NULL, 
	packaging_unit VARCHAR(20) DEFAULT 'EA' NOT NULL, 
	supplier_item_code VARCHAR, 
	delivery_place_id INTEGER, 
	ji_ku_text VARCHAR, 
	kumitsuke_ku_text VARCHAR, 
	delivery_place_name VARCHAR, 
	shipping_warehouse_name VARCHAR, 
	supplier_id INTEGER, 
	PRIMARY KEY (id), 
	CONSTRAINT uq_products_product_code UNIQUE (product_code), 
	FOREIGN KEY(delivery_place_id) REFERENCES delivery_places (id), 
	FOREIGN KEY(supplier_id) REFERENCES suppliers (id) ON DELETE RESTRICT
)



CREATE TABLE products (
	id INTEGER NOT NULL, 
	product_code TEXT NOT NULL, 
	product_name TEXT NOT NULL, 
	customer_part_no TEXT, 
	maker_item_code TEXT, 
	internal_unit TEXT NOT NULL, 
	assemble_div TEXT, 
	next_div TEXT, 
	shelf_life_days INTEGER, 
	requires_lot_number INTEGER, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_by VARCHAR(50), 
	updated_by VARCHAR(50), 
	deleted_at DATETIME, 
	revision INTEGER DEFAULT 1 NOT NULL, 
	base_unit VARCHAR(10) DEFAULT 'EA' NOT NULL, 
	packaging_qty NUMERIC(10, 2) DEFAULT 1 NOT NULL, 
	packaging_unit VARCHAR(20) DEFAULT 'EA' NOT NULL, 
	supplier_item_code VARCHAR, 
	delivery_place_id INTEGER, 
	ji_ku_text VARCHAR, 
	kumitsuke_ku_text VARCHAR, 
	delivery_place_name VARCHAR, 
	shipping_warehouse_name VARCHAR, 
	supplier_id INTEGER, 
	PRIMARY KEY (id), 
	CONSTRAINT uq_products_product_code UNIQUE (product_code), 
	FOREIGN KEY(delivery_place_id) REFERENCES delivery_places (id), 
	FOREIGN KEY(supplier_id) REFERENCES suppliers (id) ON DELETE RESTRICT
)


2025-11-10 17:59:03,666 INFO sqlalchemy.engine.Engine [no key 0.00023s] ()
[no key 0.00023s] ()
2025-11-10 17:59:03,673 INFO sqlalchemy.engine.Engine CREATE INDEX ix_products_product_code ON products (product_code)
CREATE INDEX ix_products_product_code ON products (product_code)
2025-11-10 17:59:03,673 INFO sqlalchemy.engine.Engine [no key 0.00015s] ()
[no key 0.00015s] ()
2025-11-10 17:59:03,680 INFO sqlalchemy.engine.Engine 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	order_no TEXT NOT NULL, 
	order_date DATE NOT NULL, 
	status TEXT NOT NULL, 
	sap_order_id TEXT, 
	sap_status TEXT, 
	sap_sent_at DATETIME, 
	sap_error_msg TEXT, 
	created_at DATETIME, 
	updated_at DATETIME, 
	created_by VARCHAR(50), 
	updated_by VARCHAR(50), 
	deleted_at DATETIME, 
	revision INTEGER DEFAULT 1 NOT NULL, 
	customer_order_no TEXT, 
	delivery_mode TEXT, 
	customer_id INTEGER, 
	customer_code TEXT, 
	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
	PRIMARY KEY (id), 
	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
)



CREATE TABLE orders (
	id INTEGER NOT NULL, 
	order_no TEXT NOT NULL, 
	order_date DATE NOT NULL, 
	status TEXT NOT NULL, 
	sap_order_id TEXT, 
	sap_status TEXT, 
	sap_sent_at DATETIME, 
	sap_error_msg TEXT, 
	created_at DATETIME, 
	updated_at DATETIME, 
	created_by VARCHAR(50), 
	updated_by VARCHAR(50), 
	deleted_at DATETIME, 
	revision INTEGER DEFAULT 1 NOT NULL, 
	customer_order_no TEXT, 
	delivery_mode TEXT, 
	customer_id INTEGER, 
	customer_code TEXT, 
	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
	PRIMARY KEY (id), 
	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
)


2025-11-10 17:59:03,681 INFO sqlalchemy.engine.Engine [no key 0.00024s] ()
[no key 0.00024s] ()
2025-11-10 17:59:03,681 INFO sqlalchemy.engine.Engine ROLLBACK
ROLLBACK
------------------------------ Captured log setup ------------------------------
INFO     sqlalchemy.engine.Engine:base.py:2701 BEGIN (implicit)
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("forecasts")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("forecasts")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("lots")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("lots")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("lot_current_stock")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("lot_current_stock")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("stock_movements")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("stock_movements")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("expiry_rules")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("expiry_rules")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("inbound_submissions")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("inbound_submissions")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("sap_sync_logs")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("sap_sync_logs")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("warehouses")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("warehouses")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("suppliers")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("suppliers")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("customers")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("customers")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("delivery_places")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("delivery_places")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("products")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("products")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("unit_conversions")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("unit_conversions")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("orders")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("orders")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("order_lines")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("order_lines")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("order_line_warehouse_allocation")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("order_line_warehouse_allocation")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("allocations")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("allocations")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("purchase_requests")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("purchase_requests")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE lot_current_stock (
	lot_id INTEGER NOT NULL, 
	product_id INTEGER NOT NULL, 
	warehouse_id INTEGER NOT NULL, 
	current_quantity NUMERIC(15, 4) NOT NULL, 
	last_updated DATETIME, 
	PRIMARY KEY (lot_id, product_id, warehouse_id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00015s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE inbound_submissions (
	id INTEGER NOT NULL, 
	submission_id TEXT, 
	source_uri TEXT, 
	source VARCHAR(20) DEFAULT 'ocr' NOT NULL, 
	operator TEXT, 
	submission_date DATETIME, 
	status TEXT, 
	total_records INTEGER, 
	processed_records INTEGER, 
	failed_records INTEGER, 
	skipped_records INTEGER, 
	error_details TEXT, 
	created_at DATETIME, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_by VARCHAR(50), 
	updated_by VARCHAR(50), 
	deleted_at DATETIME, 
	revision INTEGER DEFAULT 1 NOT NULL, 
	PRIMARY KEY (id), 
	CONSTRAINT ocr_submissions_submission_id_key UNIQUE (submission_id), 
	CONSTRAINT ck_inbound_submissions_source CHECK (source IN ('ocr','manual','edi'))
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00016s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE warehouses (
	id INTEGER NOT NULL, 
	warehouse_code TEXT NOT NULL, 
	warehouse_name TEXT NOT NULL, 
	address TEXT, 
	is_active BOOLEAN DEFAULT true NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_by VARCHAR(50), 
	updated_by VARCHAR(50), 
	deleted_at DATETIME, 
	revision INTEGER DEFAULT 1 NOT NULL, 
	PRIMARY KEY (id), 
	CONSTRAINT uq_warehouses_warehouse_code UNIQUE (warehouse_code)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00017s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE UNIQUE INDEX uq_warehouses_id ON warehouses (id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00016s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE suppliers (
	id INTEGER NOT NULL, 
	supplier_code TEXT NOT NULL, 
	supplier_name TEXT NOT NULL, 
	address TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_by VARCHAR(50), 
	updated_by VARCHAR(50), 
	deleted_at DATETIME, 
	revision INTEGER DEFAULT 1 NOT NULL, 
	PRIMARY KEY (id), 
	CONSTRAINT uq_suppliers_supplier_code UNIQUE (supplier_code)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00016s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_suppliers_supplier_code ON suppliers (supplier_code)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00016s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE customers (
	id INTEGER NOT NULL, 
	customer_code TEXT NOT NULL, 
	customer_name TEXT NOT NULL, 
	address TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_by VARCHAR(50), 
	updated_by VARCHAR(50), 
	deleted_at DATETIME, 
	revision INTEGER DEFAULT 1 NOT NULL, 
	PRIMARY KEY (id), 
	CONSTRAINT uq_customers_customer_code UNIQUE (customer_code)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00017s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_customers_customer_code ON customers (customer_code)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00019s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE delivery_places (
	id INTEGER NOT NULL, 
	delivery_place_code VARCHAR NOT NULL, 
	delivery_place_name VARCHAR NOT NULL, 
	address VARCHAR, 
	postal_code VARCHAR, 
	is_active BOOLEAN DEFAULT true NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_by VARCHAR(50), 
	updated_by VARCHAR(50), 
	deleted_at DATETIME, 
	revision INTEGER DEFAULT 1 NOT NULL, 
	PRIMARY KEY (id), 
	CONSTRAINT uq_delivery_places_code UNIQUE (delivery_place_code)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00016s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_delivery_places_delivery_place_code ON delivery_places (delivery_place_code)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00016s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE products (
	id INTEGER NOT NULL, 
	product_code TEXT NOT NULL, 
	product_name TEXT NOT NULL, 
	customer_part_no TEXT, 
	maker_item_code TEXT, 
	internal_unit TEXT NOT NULL, 
	assemble_div TEXT, 
	next_div TEXT, 
	shelf_life_days INTEGER, 
	requires_lot_number INTEGER, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_by VARCHAR(50), 
	updated_by VARCHAR(50), 
	deleted_at DATETIME, 
	revision INTEGER DEFAULT 1 NOT NULL, 
	base_unit VARCHAR(10) DEFAULT 'EA' NOT NULL, 
	packaging_qty NUMERIC(10, 2) DEFAULT 1 NOT NULL, 
	packaging_unit VARCHAR(20) DEFAULT 'EA' NOT NULL, 
	supplier_item_code VARCHAR, 
	delivery_place_id INTEGER, 
	ji_ku_text VARCHAR, 
	kumitsuke_ku_text VARCHAR, 
	delivery_place_name VARCHAR, 
	shipping_warehouse_name VARCHAR, 
	supplier_id INTEGER, 
	PRIMARY KEY (id), 
	CONSTRAINT uq_products_product_code UNIQUE (product_code), 
	FOREIGN KEY(delivery_place_id) REFERENCES delivery_places (id), 
	FOREIGN KEY(supplier_id) REFERENCES suppliers (id) ON DELETE RESTRICT
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00023s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_products_product_code ON products (product_code)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00015s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	order_no TEXT NOT NULL, 
	order_date DATE NOT NULL, 
	status TEXT NOT NULL, 
	sap_order_id TEXT, 
	sap_status TEXT, 
	sap_sent_at DATETIME, 
	sap_error_msg TEXT, 
	created_at DATETIME, 
	updated_at DATETIME, 
	created_by VARCHAR(50), 
	updated_by VARCHAR(50), 
	deleted_at DATETIME, 
	revision INTEGER DEFAULT 1 NOT NULL, 
	customer_order_no TEXT, 
	delivery_mode TEXT, 
	customer_id INTEGER, 
	customer_code TEXT, 
	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
	PRIMARY KEY (id), 
	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00024s] ()
INFO     sqlalchemy.engine.Engine:base.py:2704 ROLLBACK
______ ERROR at setup of test_create_stock_movement_updates_current_stock ______

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
_____________ ERROR at setup of test_master_crud_bulk_and_presets ______________

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
_____________ ERROR at setup of test_order_to_fefo_allocation_flow _____________

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
_________ ERROR at setup of test_get_fefo_candidates_filters_and_sorts _________

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
________________ ERROR at setup of test_validate_lines_success _________________

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
___________ ERROR at setup of test_validate_lines_insufficient_stock ___________

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
_________ ERROR at setup of TestAllocationAPI.test_drag_assign_success _________

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
___ ERROR at setup of TestAllocationAPI.test_drag_assign_insufficient_stock ____

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
______ ERROR at setup of TestAllocationAPI.test_cancel_allocation_success ______

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
_____ ERROR at setup of TestAllocationAPI.test_cancel_allocation_not_found _____

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
________ ERROR at setup of TestRoundingPolicy.test_round_allocation_qty ________

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
__________ ERROR at setup of TestStateMachine.test_valid_transitions ___________

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
_________ ERROR at setup of TestStateMachine.test_invalid_transitions __________

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
_______________________ ERROR at setup of test_health_ok _______________________

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
___________ ERROR at setup of TestOrderAPI.test_create_order_success ___________

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
__________ ERROR at setup of TestOrderAPI.test_create_order_duplicate __________

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
____________ ERROR at setup of TestOrderAPI.test_get_order_success _____________

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
_______ ERROR at setup of TestOrderAPI.test_update_order_status_success ________

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
___________ ERROR at setup of TestOrderAPI.test_cancel_order_success ___________

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
________ ERROR at setup of TestOrderStateMachine.test_valid_transitions ________

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
_______ ERROR at setup of TestOrderStateMachine.test_invalid_transitions _______

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
_______ ERROR at setup of TestOrderBusinessRules.test_validate_quantity ________

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
_ ERROR at setup of TestOrderBusinessRules.test_calculate_progress_percentage __

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
___________________ ERROR at setup of test_core_routes_exist ___________________

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
__________________ ERROR at setup of test_schemas_reexport_ok __________________

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
________________ ERROR at setup of test_order_validation_error _________________

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

self = <Coroutine test_order_validation_error>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()
               ^^^^^^^^^^^^^^^

/usr/local/lib/python3.12/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/conftest.py:30: in setup_database
    Base.metadata.create_all(bind=engine)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
___________ ERROR at setup of test_to_internal_qty_rounds_up_for_box ___________

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
___________ ERROR at setup of test_to_internal_qty_rounds_up_for_can ___________

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
____________ ERROR at setup of test_to_internal_qty_half_up_for_ea _____________

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
_____________ ERROR at setup of test_to_internal_qty_handles_zero ______________

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
___________ ERROR at setup of test_to_internal_qty_decimal_precision ___________

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
____________ ERROR at setup of test_to_internal_qty_negative_error _____________

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
_________ ERROR at setup of test_to_internal_qty_zero_packaging_error __________

self = <sqlalchemy.engine.base.Connection object at 0x7effcba6bfb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteDDLCompiler object at 0x7effcb8fa360>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such function: right

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.fixture(scope="session", autouse=True)
    def setup_database():
        """"""
        if TEST_DB_PATH.exists():
            TEST_DB_PATH.unlink()
    
        # 
        from app.models import Base
>       Base.metadata.create_all(bind=engine)

tests/conftest.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5868: in create_all
    bind._run_ddl_visitor(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3253: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2459: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:918: in visit_metadata
    self.traverse_single(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:664: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:956: in visit_table
    )._invoke_with(self.connection)
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:314: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:180: in _execute_on_connection
    return connection._execute_ddl(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1529: in _execute_ddl
    ret = self._execute_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7effccb085f0>
cursor = <sqlite3.Cursor object at 0x7effcb87edc0>
statement = "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\torder_no TEXT NOT NULL, \n\torder_date DATE NOT NULL, \n\tstatus ...de IN ('normal','express','pickup')), \n\tFOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT\n)\n\n"
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7effcb82f170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such function: right
E       [SQL: 
E       CREATE TABLE orders (
E       	id INTEGER NOT NULL, 
E       	order_no TEXT NOT NULL, 
E       	order_date DATE NOT NULL, 
E       	status TEXT NOT NULL, 
E       	sap_order_id TEXT, 
E       	sap_status TEXT, 
E       	sap_sent_at DATETIME, 
E       	sap_error_msg TEXT, 
E       	created_at DATETIME, 
E       	updated_at DATETIME, 
E       	created_by VARCHAR(50), 
E       	updated_by VARCHAR(50), 
E       	deleted_at DATETIME, 
E       	revision INTEGER DEFAULT 1 NOT NULL, 
E       	customer_order_no TEXT, 
E       	delivery_mode TEXT, 
E       	customer_id INTEGER, 
E       	customer_code TEXT, 
E       	customer_order_no_last6 VARCHAR(6) GENERATED ALWAYS AS (right(customer_order_no, 6)) STORED, 
E       	PRIMARY KEY (id), 
E       	CONSTRAINT orders_order_no_key UNIQUE (order_no), 
E       	CONSTRAINT ck_orders_status CHECK (status IN ('draft','confirmed','shipped','closed')), 
E       	CONSTRAINT ck_orders_delivery_mode CHECK (delivery_mode IS NULL OR delivery_mode IN ('normal','express','pickup')), 
E       	FOREIGN KEY(customer_id) REFERENCES customers (id) ON DELETE RESTRICT
E       )
E       
E       ]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: OperationalError
=============================== warnings summary ===============================
../usr/local/lib/python3.12/site-packages/pydantic/_migration.py:283
  /usr/local/lib/python3.12/site-packages/pydantic/_migration.py:283: UserWarning: `pydantic.generics:GenericModel` has been moved to `pydantic.BaseModel`.
    warnings.warn(f'`{import_path}` has been moved to `{new_location}`.')

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/api/test_lots.py::test_list_lots_filters_by_warehouse_code - sqla...
ERROR tests/api/test_lots.py::test_create_stock_movement_updates_current_stock
ERROR tests/integration/test_masters_and_presets.py::test_master_crud_bulk_and_presets
ERROR tests/integration/test_order_flow.py::test_order_to_fefo_allocation_flow
ERROR tests/services/test_lot_service.py::test_get_fefo_candidates_filters_and_sorts
ERROR tests/services/test_order_validation.py::test_validate_lines_success - ...
ERROR tests/services/test_order_validation.py::test_validate_lines_insufficient_stock
ERROR tests/test_allocations_refactored.py::TestAllocationAPI::test_drag_assign_success
ERROR tests/test_allocations_refactored.py::TestAllocationAPI::test_drag_assign_insufficient_stock
ERROR tests/test_allocations_refactored.py::TestAllocationAPI::test_cancel_allocation_success
ERROR tests/test_allocations_refactored.py::TestAllocationAPI::test_cancel_allocation_not_found
ERROR tests/test_allocations_refactored.py::TestRoundingPolicy::test_round_allocation_qty
ERROR tests/test_allocations_refactored.py::TestStateMachine::test_valid_transitions
ERROR tests/test_allocations_refactored.py::TestStateMachine::test_invalid_transitions
ERROR tests/test_health.py::test_health_ok - sqlalchemy.exc.OperationalError:...
ERROR tests/test_orders_refactored.py::TestOrderAPI::test_create_order_success
ERROR tests/test_orders_refactored.py::TestOrderAPI::test_create_order_duplicate
ERROR tests/test_orders_refactored.py::TestOrderAPI::test_get_order_success
ERROR tests/test_orders_refactored.py::TestOrderAPI::test_update_order_status_success
ERROR tests/test_orders_refactored.py::TestOrderAPI::test_cancel_order_success
ERROR tests/test_orders_refactored.py::TestOrderStateMachine::test_valid_transitions
ERROR tests/test_orders_refactored.py::TestOrderStateMachine::test_invalid_transitions
ERROR tests/test_orders_refactored.py::TestOrderBusinessRules::test_validate_quantity
ERROR tests/test_orders_refactored.py::TestOrderBusinessRules::test_calculate_progress_percentage
ERROR tests/test_routes_registered.py::test_core_routes_exist - sqlalchemy.ex...
ERROR tests/test_schemas_reexport.py::test_schemas_reexport_ok - sqlalchemy.e...
ERROR tests/test_validation.py::test_order_validation_error - sqlalchemy.exc....
ERROR tests/unit/test_quantity.py::test_to_internal_qty_rounds_up_for_box - s...
ERROR tests/unit/test_quantity.py::test_to_internal_qty_rounds_up_for_can - s...
ERROR tests/unit/test_quantity.py::test_to_internal_qty_half_up_for_ea - sqla...
ERROR tests/unit/test_quantity.py::test_to_internal_qty_handles_zero - sqlalc...
ERROR tests/unit/test_quantity.py::test_to_internal_qty_decimal_precision - s...
ERROR tests/unit/test_quantity.py::test_to_internal_qty_negative_error - sqla...
ERROR tests/unit/test_quantity.py::test_to_internal_qty_zero_packaging_error


===== ruff check (backend) =====

sh: 1: ruff: not found


===== ruff format --check (backend) =====

sh: 1: ruff: not found


===== vulture install/probe (backend) =====



===== vulture (backend) =====

app/api/routes/admin.py:40: unused function 'get_dashboard_stats' (60% confidence)
app/api/routes/admin.py:84: unused function 'reset_database' (60% confidence)
app/api/routes/admin.py:116: unused function 'load_full_sample_data' (60% confidence)
app/api/routes/admin_healthcheck.py:17: unused function 'get_db_counts' (60% confidence)
app/api/routes/admin_healthcheck.py:52: unused function 'get_masters_health' (60% confidence)
app/api/routes/admin_presets.py:24: unused function 'list_presets' (60% confidence)
app/api/routes/admin_presets.py:35: unused function 'load_preset' (60% confidence)
app/api/routes/admin_seeds.py:12: unused function 'post_seed' (60% confidence)
app/api/routes/alerts.py:6: unused function 'get_alerts' (60% confidence)
app/api/routes/allocations.py:33: unused function 'drag_assign_allocation' (60% confidence)
app/api/routes/allocations.py:74: unused function 'delete_allocation' (60% confidence)
app/api/routes/allocations.py:114: unused function 'preview_allocations' (60% confidence)
app/api/routes/allocations.py:129: unused function 'allocate_order' (60% confidence)
app/api/routes/forecast.py:38: unused function 'list_forecast_summary' (60% confidence)
app/api/routes/forecast.py:109: unused function 'list_forecasts' (60% confidence)
app/api/routes/forecast.py:170: unused function 'create_forecast' (60% confidence)
app/api/routes/forecast.py:185: unused function 'get_forecast' (60% confidence)
app/api/routes/forecast.py:194: unused function 'update_forecast' (60% confidence)
app/api/routes/forecast.py:211: unused function 'delete_forecast' (60% confidence)
app/api/routes/forecast.py:224: unused function 'bulk_import_forecasts' (60% confidence)
app/api/routes/forecast.py:283: unused function 'list_versions' (60% confidence)
app/api/routes/forecast.py:320: unused function 'activate_version' (60% confidence)
app/api/routes/forecast.py:365: unused function 'match_forecasts' (60% confidence)
app/api/routes/health.py:10: unused function 'healthz' (60% confidence)
app/api/routes/health.py:16: unused function 'readyz' (60% confidence)
app/api/routes/health.py:23: unused function 'health' (60% confidence)
app/api/routes/integration.py:42: unused function 'submit_ocr_data' (60% confidence)
app/api/routes/integration.py:71: unused variable 'idx' (60% confidence)
app/api/routes/integration.py:197: unused function 'list_ocr_submissions' (60% confidence)
app/api/routes/integration.py:225: unused function 'register_to_sap' (60% confidence)
app/api/routes/integration.py:297: unused function 'list_sap_logs' (60% confidence)
app/api/routes/lots.py:35: unused function 'list_lots' (60% confidence)
app/api/routes/lots.py:105: unused function 'create_lot' (60% confidence)
app/api/routes/lots.py:220: unused function 'update_lot' (60% confidence)
app/api/routes/lots.py:280: unused function 'delete_lot' (60% confidence)
app/api/routes/lots.py:293: unused function 'list_lot_movements' (60% confidence)
app/api/routes/lots.py:305: unused function 'create_stock_movement' (60% confidence)
app/api/routes/masters_bulk_load.py:77: unused function 'bulk_load_masters' (60% confidence)
app/api/routes/masters_customers.py:15: unused function 'list_customers' (60% confidence)
app/api/routes/masters_customers.py:27: unused function 'get_customer' (60% confidence)
app/api/routes/masters_customers.py:37: unused function 'create_customer' (60% confidence)
app/api/routes/masters_customers.py:52: unused function 'update_customer' (60% confidence)
app/api/routes/masters_customers.py:68: unused function 'delete_customer' (60% confidence)
app/api/routes/masters_suppliers.py:15: unused function 'list_suppliers' (60% confidence)
app/api/routes/masters_suppliers.py:27: unused function 'get_supplier' (60% confidence)
app/api/routes/masters_suppliers.py:37: unused function 'create_supplier' (60% confidence)
app/api/routes/masters_suppliers.py:52: unused function 'update_supplier' (60% confidence)
app/api/routes/masters_suppliers.py:68: unused function 'delete_supplier' (60% confidence)
app/api/routes/masters_warehouses.py:15: unused function 'list_warehouses' (60% confidence)
app/api/routes/masters_warehouses.py:29: unused function 'get_warehouse' (60% confidence)
app/api/routes/masters_warehouses.py:39: unused function 'create_warehouse' (60% confidence)
app/api/routes/masters_warehouses.py:56: unused function 'update_warehouse' (60% confidence)
app/api/routes/masters_warehouses.py:74: unused function 'delete_warehouse' (60% confidence)
app/api/routes/orders.py:21: unused function 'validate_order_stock' (60% confidence)
app/api/routes/orders_refactored.py:26: unused function 'list_orders' (60% confidence)
app/api/routes/orders_refactored.py:56: unused function 'get_order' (60% confidence)
app/api/routes/orders_validate.py:30: unused function 'validate_order_stock' (60% confidence)
app/api/routes/shipping.py:6: unused function 'get_shipping_list' (60% confidence)
app/api/routes/warehouse_alloc.py:19: unused function 'list_warehouses' (60% confidence)
app/core/config.py:18: unused variable 'model_config' (60% confidence)
app/core/config.py:25: unused variable 'secret_key' (60% confidence)
app/core/config.py:29: unused variable 'algorithm' (60% confidence)
app/core/config.py:33: unused variable 'access_token_expire_minutes' (60% confidence)
app/core/config.py:60: unused method 'parse_cors_origins' (60% confidence)
app/core/config.py:82: unused variable 'DEFAULT_PAGE_SIZE' (60% confidence)
app/core/config.py:83: unused variable 'MAX_PAGE_SIZE' (60% confidence)
app/core/config.py:86: unused variable 'ALERT_EXPIRY_CRITICAL_DAYS' (60% confidence)
app/core/config.py:87: unused variable 'ALERT_EXPIRY_WARNING_DAYS' (60% confidence)
app/core/config.py:91: unused variable 'MAX_UPLOAD_SIZE' (60% confidence)
app/core/database.py:76: unused function '_drop_dependent_views' (60% confidence)
app/domain/allocation/rounding.py:69: unused method 'round_stock_qty' (60% confidence)
app/domain/allocation/state_machine.py:93: unused method 'can_cancel' (60% confidence)
app/domain/allocation/state_machine.py:98: unused method 'can_ship' (60% confidence)
app/domain/lot/__init__.py:50: unused variable 'lot_code' (60% confidence)
app/domain/order/business_rules.py:66: unused method 'calculate_progress_percentage' (60% confidence)
app/domain/order/state_machine.py:87: unused method 'can_cancel' (60% confidence)
app/domain/order/state_machine.py:92: unused method 'can_ship' (60% confidence)
app/domain/warehouse_and_forecast.py:47: unused method 'validate_total_quantity' (60% confidence)
app/domain/warehouse_and_forecast.py:68: unused method 'validate_positive_quantities' (60% confidence)
app/domain/warehouse_and_forecast.py:135: unused variable 'forecasted_demand' (60% confidence)
app/domain/warehouse_and_forecast.py:136: unused variable 'match_confidence' (60% confidence)
app/domain/warehouse_and_forecast.py:156: unused method 'calculate_match_confidence' (60% confidence)
app/domain/warehouse_and_forecast.py:188: unused method 'validate_forecast_quantity' (60% confidence)
app/middleware/request_id.py:13: unused method 'dispatch' (60% confidence)
app/middleware/request_id.py:15: unused attribute 'request_id' (60% confidence)
app/models/base_model.py:12: unused variable 'connection_record' (100% confidence)
app/models/forecast.py:43: unused variable 'created_at' (60% confidence)
app/models/forecast.py:46: unused variable 'updated_by' (60% confidence)
app/models/forecast.py:47: unused variable 'deleted_at' (60% confidence)
app/models/forecast.py:48: unused variable 'revision' (60% confidence)
app/models/inventory.py:34: unused variable 'INBOUND' (60% confidence)
app/models/inventory.py:35: unused variable 'OUTBOUND' (60% confidence)
app/models/inventory.py:36: unused variable 'TRANSFER' (60% confidence)
app/models/inventory.py:37: unused variable 'ADJUSTMENT' (60% confidence)
app/models/inventory.py:38: unused variable 'SCRAP' (60% confidence)
app/models/inventory.py:49: unused variable 'mfg_date' (60% confidence)
app/models/inventory.py:51: unused variable 'kanban_class' (60% confidence)
app/models/inventory.py:52: unused variable 'sales_unit' (60% confidence)
app/models/inventory.py:53: unused variable 'inventory_unit' (60% confidence)
app/models/inventory.py:54: unused variable 'received_by' (60% confidence)
app/models/inventory.py:55: unused variable 'source_doc' (60% confidence)
app/models/inventory.py:56: unused variable 'qc_certificate_status' (60% confidence)
app/models/inventory.py:57: unused variable 'qc_certificate_file' (60% confidence)
app/models/inventory.py:58: unused variable 'created_at' (60% confidence)
app/models/inventory.py:61: unused variable 'updated_by' (60% confidence)
app/models/inventory.py:62: unused variable 'deleted_at' (60% confidence)
app/models/inventory.py:63: unused variable 'revision' (60% confidence)
app/models/inventory.py:64: unused variable 'warehouse_code_old' (60% confidence)
app/models/inventory.py:67: unused variable 'lock_reason' (60% confidence)
app/models/inventory.py:68: unused variable 'inspection_date' (60% confidence)
app/models/inventory.py:69: unused variable 'inspection_result' (60% confidence)
app/models/inventory.py:93: unused variable 'stock_movements' (60% confidence)
app/models/inventory.py:135: unused variable 'occurred_at' (60% confidence)
app/models/inventory.py:136: unused variable 'created_at' (60% confidence)
app/models/inventory.py:143: unused variable 'updated_by' (60% confidence)
app/models/inventory.py:144: unused variable 'deleted_at' (60% confidence)
app/models/inventory.py:145: unused variable 'revision' (60% confidence)
app/models/inventory.py:173: unused variable 'rule_type' (60% confidence)
app/models/inventory.py:175: unused variable 'fixed_date' (60% confidence)
app/models/inventory.py:177: unused variable 'priority' (60% confidence)
app/models/inventory.py:178: unused variable 'created_at' (60% confidence)
app/models/inventory.py:185: unused variable 'updated_by' (60% confidence)
app/models/inventory.py:186: unused variable 'deleted_at' (60% confidence)
app/models/inventory.py:187: unused variable 'revision' (60% confidence)
app/models/logs.py:34: unused variable 'source_uri' (60% confidence)
app/models/logs.py:44: unused variable 'created_at' (60% confidence)
app/models/logs.py:49: unused variable 'updated_by' (60% confidence)
app/models/logs.py:50: unused variable 'deleted_at' (60% confidence)
app/models/logs.py:51: unused variable 'revision' (60% confidence)
app/models/logs.py:73: unused variable 'created_at' (60% confidence)
app/models/logs.py:80: unused variable 'updated_by' (60% confidence)
app/models/logs.py:81: unused variable 'deleted_at' (60% confidence)
app/models/logs.py:82: unused variable 'revision' (60% confidence)
app/models/masters.py:48: unused variable 'created_at' (60% confidence)
app/models/masters.py:55: unused variable 'updated_by' (60% confidence)
app/models/masters.py:56: unused variable 'deleted_at' (60% confidence)
app/models/masters.py:57: unused variable 'revision' (60% confidence)
app/models/masters.py:65: unused variable 'stock_movements' (60% confidence)
app/models/masters.py:68: unused variable 'warehouse_allocations' (60% confidence)
app/models/masters.py:80: unused variable 'supplier_name' (60% confidence)
app/models/masters.py:82: unused variable 'created_at' (60% confidence)
app/models/masters.py:89: unused variable 'updated_by' (60% confidence)
app/models/masters.py:90: unused variable 'deleted_at' (60% confidence)
app/models/masters.py:91: unused variable 'revision' (60% confidence)
app/models/masters.py:102: unused variable 'expiry_rules' (60% confidence)
app/models/masters.py:105: unused variable 'purchase_requests' (60% confidence)
app/models/masters.py:117: unused variable 'customer_name' (60% confidence)
app/models/masters.py:119: unused variable 'created_at' (60% confidence)
app/models/masters.py:126: unused variable 'updated_by' (60% confidence)
app/models/masters.py:127: unused variable 'deleted_at' (60% confidence)
app/models/masters.py:128: unused variable 'revision' (60% confidence)
app/models/masters.py:148: unused variable 'delivery_place_name' (60% confidence)
app/models/masters.py:150: unused variable 'postal_code' (60% confidence)
app/models/masters.py:152: unused variable 'created_at' (60% confidence)
app/models/masters.py:159: unused variable 'updated_by' (60% confidence)
app/models/masters.py:160: unused variable 'deleted_at' (60% confidence)
app/models/masters.py:161: unused variable 'revision' (60% confidence)
app/models/masters.py:184: unused variable 'customer_part_no' (60% confidence)
app/models/masters.py:185: unused variable 'maker_item_code' (60% confidence)
app/models/masters.py:187: unused variable 'assemble_div' (60% confidence)
app/models/masters.py:189: unused variable 'shelf_life_days' (60% confidence)
app/models/masters.py:191: unused variable 'created_at' (60% confidence)
app/models/masters.py:198: unused variable 'updated_by' (60% confidence)
app/models/masters.py:199: unused variable 'deleted_at' (60% confidence)
app/models/masters.py:200: unused variable 'revision' (60% confidence)
app/models/masters.py:210: unused variable 'supplier_item_code' (60% confidence)
app/models/masters.py:211: unused variable 'delivery_place_id' (60% confidence)
app/models/masters.py:214: unused variable 'ji_ku_text' (60% confidence)
app/models/masters.py:215: unused variable 'kumitsuke_ku_text' (60% confidence)
app/models/masters.py:216: unused variable 'delivery_place_name' (60% confidence)
app/models/masters.py:217: unused variable 'shipping_warehouse_name' (60% confidence)
app/models/masters.py:230: unused variable 'delivery_place' (60% confidence)
app/models/masters.py:237: unused variable 'expiry_rules' (60% confidence)
app/models/masters.py:240: unused variable 'purchase_requests' (60% confidence)
app/models/masters.py:243: unused variable 'stock_movements' (60% confidence)
app/models/masters.py:246: unused variable 'unit_conversions' (60% confidence)
app/models/masters.py:263: unused variable 'from_unit' (60% confidence)
app/models/masters.py:264: unused variable 'to_unit' (60% confidence)
app/models/masters.py:265: unused variable 'factor' (60% confidence)
app/models/masters.py:266: unused variable 'created_at' (60% confidence)
app/models/masters.py:273: unused variable 'updated_by' (60% confidence)
app/models/masters.py:274: unused variable 'deleted_at' (60% confidence)
app/models/masters.py:275: unused variable 'revision' (60% confidence)
app/models/orders.py:48: unused variable 'created_at' (60% confidence)
app/models/orders.py:51: unused variable 'updated_by' (60% confidence)
app/models/orders.py:52: unused variable 'deleted_at' (60% confidence)
app/models/orders.py:53: unused variable 'revision' (60% confidence)
app/models/orders.py:60: unused variable 'customer_order_no_last6' (60% confidence)
app/models/orders.py:89: unused variable 'sap_sync_logs' (60% confidence)
app/models/orders.py:106: unused variable 'created_at' (60% confidence)
app/models/orders.py:111: unused variable 'updated_by' (60% confidence)
app/models/orders.py:112: unused variable 'deleted_at' (60% confidence)
app/models/orders.py:113: unused variable 'revision' (60% confidence)
app/models/orders.py:129: unused variable 'warehouse_allocations' (60% confidence)
app/models/orders.py:132: unused variable 'purchase_requests' (60% confidence)
app/models/orders.py:150: unused variable 'created_at' (60% confidence)
app/models/orders.py:157: unused variable 'updated_by' (60% confidence)
app/models/orders.py:158: unused variable 'deleted_at' (60% confidence)
app/models/orders.py:159: unused variable 'revision' (60% confidence)
app/models/orders.py:187: unused variable 'created_at' (60% confidence)
app/models/orders.py:194: unused variable 'updated_by' (60% confidence)
app/models/orders.py:195: unused variable 'deleted_at' (60% confidence)
app/models/orders.py:196: unused variable 'revision' (60% confidence)
app/models/orders.py:208: unused variable 'destination' (60% confidence)
app/models/orders.py:219: unused variable 'requested_qty' (60% confidence)
app/models/orders.py:221: unused variable 'reason_code' (60% confidence)
app/models/orders.py:222: unused variable 'src_order_line_id' (60% confidence)
app/models/orders.py:225: unused variable 'requested_date' (60% confidence)
app/models/orders.py:226: unused variable 'desired_receipt_date' (60% confidence)
app/models/orders.py:228: unused variable 'sap_po_id' (60% confidence)
app/models/orders.py:229: unused variable 'notes' (60% confidence)
app/models/orders.py:230: unused variable 'created_at' (60% confidence)
app/models/orders.py:233: unused variable 'updated_by' (60% confidence)
app/models/orders.py:234: unused variable 'deleted_at' (60% confidence)
app/models/orders.py:235: unused variable 'revision' (60% confidence)
app/repositories/allocation_repository.py:58: unused method 'find_active_by_lot_id' (60% confidence)
app/repositories/order_repository.py:16: unused class 'OrderRepository' (60% confidence)
app/repositories/order_repository.py:40: unused method 'find_by_order_no' (60% confidence)
app/repositories/order_repository.py:53: unused method 'find_all' (60% confidence)
app/repositories/order_repository.py:142: unused class 'OrderLineRepository' (60% confidence)
app/repositories/order_repository.py:166: unused method 'find_by_order_id' (60% confidence)
app/schemas/admin.py:45: unused variable 'preset' (60% confidence)
app/schemas/admin_seeds.py:37: unused variable 'stock_movements' (60% confidence)
app/schemas/admin_seeds.py:45: unused variable 'summary' (60% confidence)
app/schemas/allocations.py:44: unused variable 'created_allocation_ids' (60% confidence)
app/schemas/allocations.py:57: unused variable 'allocated_id' (60% confidence)
app/schemas/allocations.py:58: unused variable 'remaining_lot_qty' (60% confidence)
app/schemas/base.py:14: unused variable 'model_config' (60% confidence)
app/schemas/base.py:19: unused variable 'created_at' (60% confidence)
app/schemas/common.py:12: unused variable 'model_config' (60% confidence)
app/schemas/forecast.py:93: unused variable 'matched' (60% confidence)
app/schemas/forecast.py:105: unused variable 'total_lines' (60% confidence)
app/schemas/forecast.py:106: unused variable 'matched_lines' (60% confidence)
app/schemas/forecast.py:107: unused variable 'unmatched_lines' (60% confidence)
app/schemas/forecast.py:140: unused variable 'activated_version' (60% confidence)
app/schemas/forecast.py:163: unused variable 'daily_data' (60% confidence)
app/schemas/forecast.py:164: unused variable 'dekad_data' (60% confidence)
app/schemas/forecast.py:165: unused variable 'monthly_data' (60% confidence)
app/schemas/forecast.py:169: unused variable 'customer_name' (60% confidence)
app/schemas/forecast.py:170: unused variable 'supplier_name' (60% confidence)
app/schemas/integration.py:54: unused variable 'retry' (60% confidence)
app/schemas/integration.py:55: unused variable 'timeout_sec' (60% confidence)
app/schemas/integration.py:70: unused variable 'error_message' (60% confidence)
app/schemas/inventory.py:18: unused variable 'mfg_date' (60% confidence)
app/schemas/inventory.py:23: unused variable 'kanban_class' (60% confidence)
app/schemas/inventory.py:24: unused variable 'sales_unit' (60% confidence)
app/schemas/inventory.py:25: unused variable 'inventory_unit' (60% confidence)
app/schemas/inventory.py:26: unused variable 'received_by' (60% confidence)
app/schemas/inventory.py:27: unused variable 'source_doc' (60% confidence)
app/schemas/inventory.py:28: unused variable 'qc_certificate_status' (60% confidence)
app/schemas/inventory.py:29: unused variable 'qc_certificate_file' (60% confidence)
app/schemas/inventory.py:37: unused variable 'mfg_date' (60% confidence)
app/schemas/inventory.py:42: unused variable 'qc_certificate_status' (60% confidence)
app/schemas/inventory.py:43: unused variable 'qc_certificate_file' (60% confidence)
app/schemas/inventory.py:72: unused variable 'occurred_at' (60% confidence)
app/schemas/inventory.py:85: unused variable 'shelf_life_days' (60% confidence)
app/schemas/inventory.py:93: unused variable 'shelf_life_days' (60% confidence)
app/schemas/masters.py:39: unused variable 'supplier_name' (60% confidence)
app/schemas/masters.py:48: unused variable 'supplier_name' (60% confidence)
app/schemas/masters.py:59: unused variable 'customer_name' (60% confidence)
app/schemas/masters.py:68: unused variable 'customer_name' (60% confidence)
app/schemas/masters.py:81: unused variable 'customer_part_no' (60% confidence)
app/schemas/masters.py:82: unused variable 'maker_item_code' (60% confidence)
app/schemas/masters.py:83: unused variable 'supplier_item_code' (60% confidence)
app/schemas/masters.py:88: unused variable 'packaging' (60% confidence)
app/schemas/masters.py:89: unused variable 'assemble_div' (60% confidence)
app/schemas/masters.py:91: unused variable 'ji_ku_text' (60% confidence)
app/schemas/masters.py:92: unused variable 'kumitsuke_ku_text' (60% confidence)
app/schemas/masters.py:93: unused variable 'shelf_life_days' (60% confidence)
app/schemas/masters.py:95: unused variable 'delivery_place_id' (60% confidence)
app/schemas/masters.py:96: unused variable 'delivery_place_name' (60% confidence)
app/schemas/masters.py:97: unused variable 'shipping_warehouse_name' (60% confidence)
app/schemas/masters.py:107: unused variable 'customer_part_no' (60% confidence)
app/schemas/masters.py:108: unused variable 'maker_item_code' (60% confidence)
app/schemas/masters.py:109: unused variable 'supplier_item_code' (60% confidence)
app/schemas/masters.py:114: unused variable 'packaging' (60% confidence)
app/schemas/masters.py:115: unused variable 'assemble_div' (60% confidence)
app/schemas/masters.py:117: unused variable 'ji_ku_text' (60% confidence)
app/schemas/masters.py:118: unused variable 'kumitsuke_ku_text' (60% confidence)
app/schemas/masters.py:119: unused variable 'shelf_life_days' (60% confidence)
app/schemas/masters.py:121: unused variable 'delivery_place_id' (60% confidence)
app/schemas/masters.py:122: unused variable 'delivery_place_name' (60% confidence)
app/schemas/masters.py:123: unused variable 'shipping_warehouse_name' (60% confidence)
app/schemas/masters.py:133: unused variable 'source_unit' (60% confidence)
app/schemas/masters.py:134: unused variable 'source_value' (60% confidence)
app/schemas/masters.py:143: unused variable 'source_value' (60% confidence)
app/schemas/orders.py:21: unused variable 'customer_order_no_last6' (60% confidence)
app/schemas/orders.py:103: unused variable 'warehouse_allocations' (60% confidence)
app/schemas/orders.py:104: unused variable 'related_lots' (60% confidence)
app/schemas/orders.py:105: unused variable 'allocated_lots' (60% confidence)
app/schemas/orders.py:113: unused variable 'meta' (60% confidence)
app/schemas/orders.py:118: unused variable 'lot_code' (60% confidence)
app/schemas/orders.py:124: unused variable 'lot_unit_qty' (60% confidence)
app/schemas/orders.py:126: unused variable 'conversion_factor' (60% confidence)
app/schemas/orders.py:128: unused variable 'mfg_date' (60% confidence)
app/schemas/products.py:21: unused variable 'customer_part_no' (60% confidence)
app/schemas/products.py:22: unused variable 'maker_item_code' (60% confidence)
app/schemas/products.py:32: unused variable 'customer_part_no' (60% confidence)
app/schemas/products.py:33: unused variable 'maker_item_code' (60% confidence)
app/schemas/products.py:44: unused variable 'customer_part_no' (60% confidence)
app/schemas/products.py:45: unused variable 'maker_item_code' (60% confidence)
app/schemas/products.py:47: unused variable 'created_at' (60% confidence)
app/services/allocation_service.py:22: unused class 'AllocationService' (60% confidence)
app/services/allocation_service.py:42: unused method 'allocate_lot' (60% confidence)
app/services/allocation_service.py:158: unused method 'get_allocations_by_order_line' (60% confidence)
app/services/allocation_service.py:170: unused method 'get_allocation' (60% confidence)
app/services/forecast.py:188: unused attribute 'forecast_version_no' (60% confidence)
app/services/forecast_matcher.py:21: unused function 'pick_forecast' (60% confidence)
app/services/forecast_matcher.py:87: unused function 'judge_status' (60% confidence)
app/services/lot_service.py:90: unused class 'LotService' (60% confidence)
app/services/lot_service.py:103: unused method 'get_fefo_candidates' (60% confidence)
app/services/lot_service.py:135: unused method 'validate_lot_availability' (60% confidence)
app/services/quantity.py:10: unused attribute 'prec' (60% confidence)
app/services/uow.py:17: unused variable 'tb' (100% confidence)


===== tsc --noEmit (frontend) =====


> lot-management-frontend@1.0.0 typecheck
> tsc -p tsconfig.json --noEmit

src/features/allocations/api.ts(29,11): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/allocations/api.ts(44,16): error TS2339: Property 'del' does not exist on type '{ get<T>(path: string, config?: AxiosRequestConfig<any> | undefined): Promise<T>; post<T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined): Promise<...>; put<T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined): Promise<...>; patch<T>(path: string, data?: unknown,...'.
src/features/forecast/api.ts(33,10): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/forecast/api.ts(56,10): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/forecast/api.ts(65,3): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/inventory/api.ts(33,10): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/inventory/api.ts(41,39): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/inventory/api.ts(47,3): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/masters/api.ts(5,34): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/masters/api.ts(7,35): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/masters/api.ts(10,3): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/orders/api.ts(35,10): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/orders/api.ts(44,3): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/orders/api.ts(50,3): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/orders/api.ts(58,3): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/orders/api.ts(66,3): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/orders/api.ts(82,10): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/orders/api.ts(97,3): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/orders/api.ts(113,3): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/orders/api.ts(131,3): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/orders/api.ts(143,3): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/orders/hooks/useAllocations.ts(39,49): error TS7006: Parameter 'item' implicitly has an 'any' type.
src/hooks/api/useForecastQuery.ts(11,10): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/lib/admin-api.ts(19,3): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/lib/admin-api.ts(22,3): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/lib/admin-api.ts(67,3): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/lib/api-client.ts(23,18): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/lib/api-client.ts(25,27): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/lib/api-client.ts(28,5): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/lib/api-client.ts(36,22): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/lib/api-client.ts(38,23): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/lib/api-client.ts(40,24): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/lib/api-client.ts(53,12): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/lib/api-client.ts(59,5): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/pages/InventoryPage.tsx(271,11): error TS2322: Type 'Record<string, unknown>[]' is not assignable to type 'LotResponse[]'.
  Type 'Record<string, unknown>' is missing the following properties from type 'LotResponse': id, product_code, created_at
src/pages/LotAllocationPage.tsx(209,16): error TS7006: Parameter 'order' implicitly has an 'any' type.
src/pages/LotAllocationPage.tsx(216,14): error TS7006: Parameter 'a' implicitly has an 'any' type.
src/pages/LotAllocationPage.tsx(216,17): error TS7006: Parameter 'b' implicitly has an 'any' type.
src/pages/LotAllocationPage.tsx(225,30): error TS7053: Element implicitly has an 'any' type because expression of type 'any' can't be used to index type 'Record<PriorityLevel, number>'.
src/pages/LotAllocationPage.tsx(225,58): error TS7053: Element implicitly has an 'any' type because expression of type 'any' can't be used to index type 'Record<PriorityLevel, number>'.
src/pages/LotAllocationPage.tsx(245,60): error TS7006: Parameter 'line' implicitly has an 'any' type.
src/pages/LotAllocationPage.tsx(426,43): error TS7006: Parameter 'order' implicitly has an 'any' type.
src/pages/LotAllocationPage.tsx(443,37): error TS7006: Parameter 'line' implicitly has an 'any' type.
src/pages/LotAllocationPage.tsx(447,21): error TS7006: Parameter 'line' implicitly has an 'any' type.
src/pages/LotAllocationPage.tsx(448,21): error TS7006: Parameter 'line' implicitly has an 'any' type.
src/pages/LotAllocationPage.tsx(489,28): error TS7006: Parameter 'order' implicitly has an 'any' type.
src/pages/LotAllocationPage.tsx(534,53): error TS7006: Parameter 'line' implicitly has an 'any' type.
src/pages/OrderDetailPage.tsx(137,34): error TS7006: Parameter 'line' implicitly has an 'any' type.
src/pages/OrderPage.tsx(84,27): error TS7006: Parameter 'order' implicitly has an 'any' type.
src/pages/OrdersListPage.tsx(200,37): error TS7006: Parameter 'o' implicitly has an 'any' type.
src/pages/OrdersListPage.tsx(201,42): error TS7006: Parameter 'o' implicitly has an 'any' type.
src/pages/OrdersListPage.tsx(204,32): error TS7006: Parameter 'o' implicitly has an 'any' type.
src/pages/OrdersListPage.tsx(306,11): error TS2322: Type 'Record<string, unknown>[]' is not assignable to type 'OrderResponse[]'.
  Type 'Record<string, unknown>' is missing the following properties from type 'OrderResponse': id, order_no, customer_code, status


===== npm run build (frontend) =====


> lot-management-frontend@1.0.0 build
> tsc && vite build

src/features/allocations/api.ts(29,11): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/allocations/api.ts(44,16): error TS2339: Property 'del' does not exist on type '{ get<T>(path: string, config?: AxiosRequestConfig<any> | undefined): Promise<T>; post<T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined): Promise<...>; put<T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined): Promise<...>; patch<T>(path: string, data?: unknown,...'.
src/features/forecast/api.ts(33,10): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/forecast/api.ts(56,10): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/forecast/api.ts(65,3): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/inventory/api.ts(33,10): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/inventory/api.ts(41,39): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/inventory/api.ts(47,3): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/masters/api.ts(5,34): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/masters/api.ts(7,35): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/masters/api.ts(10,3): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/orders/api.ts(35,10): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/orders/api.ts(44,3): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/orders/api.ts(50,3): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/orders/api.ts(58,3): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/orders/api.ts(66,3): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/orders/api.ts(82,10): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/orders/api.ts(97,3): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/orders/api.ts(113,3): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/orders/api.ts(131,3): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/orders/api.ts(143,3): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/features/orders/hooks/useAllocations.ts(39,49): error TS7006: Parameter 'item' implicitly has an 'any' type.
src/hooks/api/useForecastQuery.ts(11,10): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/lib/admin-api.ts(19,3): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/lib/admin-api.ts(22,3): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/lib/admin-api.ts(67,3): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/lib/api-client.ts(23,18): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/lib/api-client.ts(25,27): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/lib/api-client.ts(28,5): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/lib/api-client.ts(36,22): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/lib/api-client.ts(38,23): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/lib/api-client.ts(40,24): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/lib/api-client.ts(53,12): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/lib/api-client.ts(59,5): error TS2349: This expression is not callable.
  Type '{ get: <T>(path: string, config?: AxiosRequestConfig<any> | undefined) => Promise<T>; post: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<any> | undefined) => Promise<...>; put: <T>(path: string, data?: unknown, config?: AxiosRequestConfig<...> | undefined) => Promise<...>; patch: <T>(path: string, d...' has no call signatures.
src/pages/InventoryPage.tsx(271,11): error TS2322: Type 'Record<string, unknown>[]' is not assignable to type 'LotResponse[]'.
  Type 'Record<string, unknown>' is missing the following properties from type 'LotResponse': id, product_code, created_at
src/pages/LotAllocationPage.tsx(209,16): error TS7006: Parameter 'order' implicitly has an 'any' type.
src/pages/LotAllocationPage.tsx(216,14): error TS7006: Parameter 'a' implicitly has an 'any' type.
src/pages/LotAllocationPage.tsx(216,17): error TS7006: Parameter 'b' implicitly has an 'any' type.
src/pages/LotAllocationPage.tsx(225,30): error TS7053: Element implicitly has an 'any' type because expression of type 'any' can't be used to index type 'Record<PriorityLevel, number>'.
src/pages/LotAllocationPage.tsx(225,58): error TS7053: Element implicitly has an 'any' type because expression of type 'any' can't be used to index type 'Record<PriorityLevel, number>'.
src/pages/LotAllocationPage.tsx(245,60): error TS7006: Parameter 'line' implicitly has an 'any' type.
src/pages/LotAllocationPage.tsx(426,43): error TS7006: Parameter 'order' implicitly has an 'any' type.
src/pages/LotAllocationPage.tsx(443,37): error TS7006: Parameter 'line' implicitly has an 'any' type.
src/pages/LotAllocationPage.tsx(447,21): error TS7006: Parameter 'line' implicitly has an 'any' type.
src/pages/LotAllocationPage.tsx(448,21): error TS7006: Parameter 'line' implicitly has an 'any' type.
src/pages/LotAllocationPage.tsx(489,28): error TS7006: Parameter 'order' implicitly has an 'any' type.
src/pages/LotAllocationPage.tsx(534,53): error TS7006: Parameter 'line' implicitly has an 'any' type.
src/pages/OrderDetailPage.tsx(137,34): error TS7006: Parameter 'line' implicitly has an 'any' type.
src/pages/OrderPage.tsx(84,27): error TS7006: Parameter 'order' implicitly has an 'any' type.
src/pages/OrdersListPage.tsx(200,37): error TS7006: Parameter 'o' implicitly has an 'any' type.
src/pages/OrdersListPage.tsx(201,42): error TS7006: Parameter 'o' implicitly has an 'any' type.
src/pages/OrdersListPage.tsx(204,32): error TS7006: Parameter 'o' implicitly has an 'any' type.
src/pages/OrdersListPage.tsx(306,11): error TS2322: Type 'Record<string, unknown>[]' is not assignable to type 'OrderResponse[]'.
  Type 'Record<string, unknown>' is missing the following properties from type 'OrderResponse': id, order_no, customer_code, status


===== ts-prune (frontend) =====

src/@types/aliases.ts:3 - Product
src/@types/aliases.ts:13 - Supplier
src/@types/aliases.ts:19 - Customer
src/@types/aliases.ts:24 - Warehouse
src/@types/aliases.ts:30 - OldWarehouse
src/@types/aliases.ts:33 - LotResponse
src/@types/aliases.ts:49 - LotCreate
src/@types/aliases.ts:50 - LotWithStock
src/@types/aliases.ts:53 - AllocatedLot
src/@types/aliases.ts:60 - LotCandidate
src/@types/aliases.ts:77 - LotCandidateResponse
src/@types/aliases.ts:79 - WarehouseAlloc
src/@types/aliases.ts:88 - LotAllocationRequest
src/@types/aliases.ts:91 - AllocationCancelRequest
src/@types/aliases.ts:96 - OrderLine
src/@types/aliases.ts:109 - OrderResponse
src/@types/aliases.ts:123 - OrderWithLinesResponse
src/@types/aliases.ts:126 - OrderLineComputed
src/@types/aliases.ts:152 - OrderLineCreate
src/@types/aliases.ts:162 - FefoLotAllocation
src/@types/aliases.ts:178 - getLotCandidates
src/@types/aliases.ts:184 - OrdersListParams
src/components/DashboardStats.tsx:8 - DashboardStats (used in module)
src/components/WarehouseAllocationModal.tsx:37 - WarehouseAllocationModal
src/factories/index.ts:13 - createLot
src/factories/index.ts:38 - createLots
src/factories/index.ts:45 - createLotWithStock
src/factories/index.ts:55 - createLotWithoutStock
src/factories/index.ts:65 - createExpiredLot
src/factories/index.ts:76 - createExpiringLot
src/factories/index.ts:25 - createOrder
src/factories/index.ts:44 - createOrderLine
src/factories/index.ts:109 - createOrderWithLines
src/factories/index.ts:152 - createOrders
src/factories/index.ts:159 - createPendingOrder
src/factories/index.ts:171 - createAllocatedOrder
src/factories/index.ts:194 - createShippedOrder
src/factories/index.ts:206 - createCancelledOrder
src/factories/index.ts:20 - OrderLineFactoryResult
src/factories/index.ts:13 - createProduct
src/factories/index.ts:24 - createProducts
src/factories/index.ts:31 - createSupplier
src/factories/index.ts:43 - createSuppliers
src/factories/index.ts:50 - createWarehouse
src/factories/index.ts:66 - createWarehouses
src/factories/index.ts:73 - createActiveWarehouse
src/factories/index.ts:83 - createInactiveWarehouse
src/hooks/use-toast.ts:5 - ToastProps (used in module)
src/hooks/use-toast.ts:75 - reducer (used in module)
src/hooks/use-toast.ts:182 - toast (used in module)
src/hooks/useDragAssign.ts:9 - DragAssignRequest (used in module)
src/hooks/useDragAssign.ts:16 - DragAssignResponse (used in module)
src/hooks/useDragAssign.ts:25 - useDragAssign
src/hooks/useForecasts.ts:13 - useForecasts
src/hooks/useForecasts.ts:19 - useForecast
src/hooks/useLots.ts:11 - useLots
src/hooks/useLots.ts:17 - useLot
src/hooks/useOrderQuery.ts:9 - OrderLine (used in module)
src/hooks/useOrderQuery.ts:24 - OrderDetail (used in module)
src/hooks/useOrderQuery.ts:38 - useOrderQuery
src/hooks/useOrders.ts:18 - useOrder
src/lib/api.ts:8 - api
src/lib/apiClient.ts:23 - post (used in module)
src/lib/apiClient.ts:30 - getForecastList
src/lib/apiClient.ts:7 - http (used in module)
src/lib/csv.ts:9 - exportToCSV
src/lib/http.ts:18 - toApiUrl (used in module)
src/lib/http.ts:94 - API_BASE
src/lib/http.ts:95 - axiosClient
src/mocks/browser.ts:18 - startMockServiceWorker
src/mocks/browser.ts:13 - worker (used in module)
src/pages/OrderDetailPage.tsx:12 - OrderDetailPage
src/pages/OrderPage.tsx:17 - OrderPage
src/pages/OrdersPage.tsx:11 - OrdersPage
src/services/api.ts:109 - getOrdersWithAllocations (used in module)
src/services/api.ts:114 - reMatchOrder (used in module)
src/services/api.ts:93 - Order (used in module)
src/services/api.ts:93 - OrderDetail (used in module)
src/services/api.ts:93 - DragAssignRequest (used in module)
src/services/api.ts:93 - DragAssignResponse (used in module)
src/services/api.ts:93 - Lot (used in module)
src/services/api.ts:93 - ForecastResponse (used in module)
src/services/api.ts:96 - DashboardStats (used in module)
src/services/http.ts:64 - get (used in module)
src/services/http.ts:71 - post (used in module)
src/services/http.ts:82 - put (used in module)
src/services/http.ts:93 - patch (used in module)
src/services/http.ts:104 - del (used in module)
src/services/http.ts:112 - default
src/types/api.d.ts:1074 - webhooks
src/types/api.d.ts:2450 - $defs
src/types/api.d.ts:2451 - operations (used in module)
src/components/shared/CommonUI.tsx:13 - LoadingSpinner
src/components/shared/CommonUI.tsx:30 - LoadingPage
src/components/shared/CommonUI.tsx:42 - ErrorDisplay
src/components/shared/CommonUI.tsx:72 - ErrorPage
src/components/shared/CommonUI.tsx:121 - EmptyState
src/components/shared/ErrorBoundary.tsx:23 - ErrorBoundary
src/components/shared/index.ts:11 - DataTable
src/components/shared/index.ts:11 - SortConfig
src/components/shared/index.ts:11 - TablePaginationProps
src/components/shared/index.ts:11 - SelectOption
src/components/ui/badge.tsx:26 - BadgeProps (used in module)
src/components/ui/badge.tsx:36 - badgeVariants (used in module)
src/components/ui/button.tsx:33 - ButtonProps (used in module)
src/components/ui/button.tsx:49 - buttonVariants (used in module)
src/components/ui/dialog.tsx:93 - DialogPortal (used in module)
src/components/ui/dialog.tsx:94 - DialogOverlay (used in module)
src/components/ui/dialog.tsx:95 - DialogClose (used in module)
src/components/ui/dialog.tsx:96 - DialogTrigger (used in module)
src/components/ui/icons.tsx:3 - RefreshCcw
src/components/ui/icons.tsx:23 - Edit
src/components/ui/select.tsx:149 - SelectGroup (used in module)
src/components/ui/select.tsx:153 - SelectLabel (used in module)
src/components/ui/select.tsx:155 - SelectSeparator (used in module)
src/components/ui/select.tsx:156 - SelectScrollUpButton (used in module)
src/components/ui/select.tsx:157 - SelectScrollDownButton (used in module)
src/components/ui/table.tsx:91 - TableFooter (used in module)
src/components/ui/table.tsx:91 - TableCaption (used in module)
src/components/ui/textarea.tsx:11 - TextareaProps (used in module)
src/features/allocations/api.ts:5 - AllocationInputItem (used in module)
src/features/orders/OrdersPage.tsx:34 - OrdersPage
src/hooks/api/index.ts:8 - useLotsQuery
src/hooks/api/index.ts:8 - useOrdersQuery
src/hooks/api/index.ts:24 - useProductsQuery
src/hooks/api/index.ts:47 - useCustomersQuery
src/hooks/api/index.ts:70 - useWarehousesQuery
src/hooks/api/index.ts:88 - useProductQuery
src/hooks/api/index.ts:108 - useCustomerQuery
src/hooks/api/index.ts:128 - useWarehouseQuery
src/hooks/api/index.ts:158 - useAllMastersQuery
src/hooks/api/index.ts:176 - createSelectOptions
src/hooks/api/index.ts:192 - useProductOptions
src/hooks/api/index.ts:208 - useCustomerOptions
src/hooks/api/index.ts:221 - useWarehouseOptions
src/hooks/api/useForecastQuery.ts:9 - getForecasts
src/hooks/mutations/index.ts:31 - useCreateLot
src/hooks/mutations/index.ts:69 - useUpdateLot
src/hooks/mutations/index.ts:114 - useDeleteLot
src/hooks/mutations/index.ts:145 - useBulkCreateLots
src/hooks/mutations/index.ts:187 - useUpdateLotStatus
src/hooks/mutations/index.ts:30 - useCreateOrder
src/hooks/mutations/index.ts:70 - useUpdateOrder
src/hooks/mutations/index.ts:115 - useDeleteOrder
src/hooks/mutations/index.ts:161 - useUpdateOrderStatus
src/hooks/mutations/index.ts:192 - useBulkCreateOrders
src/hooks/mutations/index.ts:38 - useCreateAllocations
src/hooks/mutations/index.ts:95 - useCancelAllocation
src/hooks/mutations/index.ts:126 - useBulkCancelAllocations
src/hooks/mutations/index.ts:164 - useCancelAllAllocationsForLine
src/hooks/mutations/index.ts:218 - useAutoAllocate
src/hooks/ui/index.ts:31 - useDialog
src/hooks/ui/index.ts:72 - useDialogWithData
src/hooks/ui/index.ts:128 - useConfirmDialog
src/hooks/ui/index.ts:200 - useMultipleDialogs
src/hooks/ui/index.ts:51 - useToast
src/hooks/ui/index.ts:144 - useSingleToast
src/hooks/ui/index.ts:229 - usePromiseToast
src/hooks/ui/index.ts:12 - ToastVariant
src/hooks/ui/index.ts:17 - Toast
src/hooks/ui/index.ts:59 - useTable
src/hooks/ui/index.ts:229 - useSelection
src/hooks/ui/index.ts:12 - SortDirection
src/hooks/ui/index.ts:17 - SortState
src/hooks/ui/index.ts:25 - PaginationState
src/hooks/ui/index.ts:44 - useFilters
src/hooks/ui/index.ts:119 - useSearchFilter
src/hooks/ui/index.ts:178 - useDateRangeFilter
src/hooks/ui/index.ts:223 - filterData
src/hooks/ui/index.ts:245 - searchData
src/hooks/ui/index.ts:12 - FilterValue
src/hooks/ui/index.ts:17 - FilterState
src/mocks/handlers/index.ts:12 - handlers
src/services/api/index.ts:15 - listLots
src/services/api/index.ts:23 - getLotById
src/services/api/index.ts:31 - createLot
src/services/api/index.ts:39 - updateLot
src/services/api/index.ts:47 - deleteLot
src/services/api/index.ts:54 - listLotsWithStock
src/services/api/index.ts:63 - listLotsByProduct
src/services/api/index.ts:70 - listLotsBySupplier
src/services/api/index.ts:15 - listOrders
src/services/api/index.ts:23 - getOrderById
src/services/api/index.ts:31 - createOrder
src/services/api/index.ts:39 - updateOrderStatus
src/services/api/index.ts:53 - deleteOrder
src/services/api/index.ts:60 - listOrdersByStatus
src/services/api/index.ts:67 - listPendingOrders
src/services/api/index.ts:74 - listAllocatedOrders
src/services/api/index.ts:81 - listShippedOrders
src/services/api/index.ts:88 - listOrdersByCustomer
src/services/api/index.ts:91 - getOrderDetail
src/services/api/index.ts:96 - updateOrder
src/services/api/index.ts:19 - listProducts
src/services/api/index.ts:27 - listSuppliers
src/services/api/index.ts:35 - listWarehouses
src/services/api/index.ts:43 - listCustomers
src/services/api/index.ts:52 - listAllMasters
src/services/api/query-keys.ts:26 - lotKeys (used in module)
src/services/api/query-keys.ts:41 - orderKeys (used in module)
src/services/api/query-keys.ts:58 - masterKeys (used in module)
src/services/api/query-keys.ts:83 - allQueryKeys
src/types/legacy/index.ts:3 - Product
src/types/legacy/index.ts:13 - Supplier
src/types/legacy/index.ts:19 - Customer
src/types/legacy/index.ts:24 - Warehouse
src/types/legacy/index.ts:30 - OldWarehouse
src/types/legacy/index.ts:33 - LotResponse
src/types/legacy/index.ts:49 - LotCreate
src/types/legacy/index.ts:50 - LotWithStock
src/types/legacy/index.ts:53 - AllocatedLot
src/types/legacy/index.ts:60 - LotCandidate
src/types/legacy/index.ts:77 - LotCandidateResponse
src/types/legacy/index.ts:79 - WarehouseAlloc
src/types/legacy/index.ts:88 - LotAllocationRequest
src/types/legacy/index.ts:91 - AllocationCancelRequest
src/types/legacy/index.ts:96 - OrderLine
src/types/legacy/index.ts:109 - OrderResponse
src/types/legacy/index.ts:123 - OrderWithLinesResponse
src/types/legacy/index.ts:126 - OrderLineComputed
src/types/legacy/index.ts:152 - OrderLineCreate
src/types/legacy/index.ts:162 - FefoLotAllocation
src/types/legacy/index.ts:178 - getLotCandidates
src/types/legacy/index.ts:184 - OrdersListParams
src/utils/errors/custom-errors.ts:25 - ValidationError (used in module)
src/utils/errors/custom-errors.ts:36 - AuthenticationError (used in module)
src/utils/errors/custom-errors.ts:47 - AuthorizationError (used in module)
src/utils/errors/custom-errors.ts:58 - NotFoundError (used in module)
src/utils/errors/custom-errors.ts:69 - ServerError (used in module)
src/utils/validators/index.ts:11 - lotCreateSchema
src/utils/validators/index.ts:30 - lotUpdateSchema
src/utils/validators/index.ts:42 - lotSearchSchema
src/utils/validators/index.ts:53 - LotCreate
src/utils/validators/index.ts:63 - LotUpdate
src/utils/validators/index.ts:65 - LotWithStock
src/utils/validators/index.ts:76 - LotCreateInput
src/utils/validators/index.ts:77 - LotUpdateInput
src/utils/validators/index.ts:78 - LotSearchParams
src/utils/validators/index.ts:3 - OrderCreate
src/utils/validators/index.ts:9 - OrderUpdate
src/utils/validators/index.ts:14 - OrderDetail
src/utils/validators/index.ts:11 - productSchema
src/utils/validators/index.ts:21 - supplierSchema
src/utils/validators/index.ts:32 - warehouseSchema
src/utils/validators/index.ts:42 - customerSchema
src/utils/validators/index.ts:51 - Product
src/utils/validators/index.ts:62 - Customer
src/utils/validators/index.ts:68 - Warehouse
src/utils/validators/index.ts:75 - Supplier
src/utils/validators/index.ts:84 - ProductInput
src/utils/validators/index.ts:85 - SupplierInput
src/utils/validators/index.ts:86 - WarehouseInput
src/utils/validators/index.ts:87 - CustomerInput
src/components/shared/data/index.ts:54 - StatusBadge
src/components/shared/data/index.ts:110 - LotStatusBadge
src/components/shared/data/index.ts:186 - OrderStatusBadge
src/components/shared/data/index.ts:38 - StatusBadgeProps
src/components/shared/data/index.ts:66 - LotStatus
src/components/shared/data/index.ts:96 - LotStatusBadgeProps
src/components/shared/data/index.ts:127 - OrderStatus
src/components/shared/data/index.ts:172 - OrderStatusBadgeProps
src/components/shared/data/index.ts:80 - DataTable
src/components/shared/data/index.ts:23 - Column
src/components/shared/data/index.ts:42 - SortConfig
src/components/shared/data/index.ts:47 - DataTableProps
src/components/shared/data/index.ts:47 - TablePagination
src/components/shared/data/index.ts:190 - SimplePagination
src/components/shared/data/index.ts:26 - TablePaginationProps
src/components/shared/data/index.ts:175 - SimplePaginationProps
src/components/shared/data/index.ts:40 - SearchBar
src/components/shared/data/index.ts:127 - InstantSearchBar
src/components/shared/data/index.ts:21 - SearchBarProps
src/components/shared/data/index.ts:110 - InstantSearchBarProps
src/components/shared/data/index.ts:47 - FilterField
src/components/shared/data/index.ts:93 - TextFilterField
src/components/shared/data/index.ts:136 - SelectFilterField
src/components/shared/data/index.ts:181 - DateFilterField
src/components/shared/data/index.ts:222 - DateRangeFilterField
src/components/shared/data/index.ts:273 - CheckboxFilterField
src/components/shared/data/index.ts:324 - NumberRangeFilterField
src/components/shared/data/index.ts:29 - FilterFieldProps
src/components/shared/data/index.ts:69 - SelectOption
src/components/shared/data/index.ts:78 - TextFilterFieldProps
src/components/shared/data/index.ts:119 - SelectFilterFieldProps
src/components/shared/data/index.ts:168 - DateFilterFieldProps
src/components/shared/data/index.ts:205 - DateRangeFilterFieldProps
src/components/shared/data/index.ts:258 - CheckboxFilterFieldProps
src/components/shared/data/index.ts:307 - NumberRangeFilterFieldProps
src/components/shared/data/index.ts:39 - FilterPanel
src/components/shared/data/index.ts:97 - CompactFilterPanel
src/components/shared/data/index.ts:130 - InlineFilterPanel
src/components/shared/data/index.ts:20 - FilterPanelProps
src/components/shared/data/index.ts:84 - CompactFilterPanelProps
src/components/shared/data/index.ts:117 - InlineFilterPanelProps
src/components/shared/data/index.ts:15 - EmptyState
src/components/shared/form/index.ts:59 - TextFormField
src/components/shared/form/index.ts:112 - TextareaFormField
src/components/shared/form/index.ts:170 - SelectFormField
src/components/shared/form/index.ts:222 - DateFormField
src/components/shared/form/index.ts:276 - NumberFormField
src/components/shared/form/index.ts:27 - BaseFormFieldProps
src/components/shared/form/index.ts:46 - TextFormFieldProps
src/components/shared/form/index.ts:99 - TextareaFormFieldProps
src/components/shared/form/index.ts:152 - SelectOption
src/components/shared/form/index.ts:157 - SelectFormFieldProps
src/components/shared/form/index.ts:213 - DateFormFieldProps
src/components/shared/form/index.ts:259 - NumberFormFieldProps
src/components/shared/form/index.ts:56 - FormDialog
src/components/shared/form/index.ts:152 - ConfirmDialog
src/components/shared/form/index.ts:27 - FormDialogProps
src/components/shared/form/index.ts:127 - ConfirmDialogProps
src/components/shared/layout/index.ts:34 - PageHeader
src/components/shared/layout/index.ts:29 - PageContainer
src/components/shared/layout/index.ts:36 - Section
src/features/forecast/components/ForecastFileUploadCard.tsx:8 - ForecastFileUploadCardProps (used in module)
src/features/orders/components/ForecastSection-v2.tsx:10 - ForecastSection
src/features/orders/components/LotAllocationPanel.tsx:61 - LotAllocationPanel
src/features/orders/components/WarehouseBadges.tsx:7 - WarehouseBadges
src/features/orders/components/WarehouseSelector.tsx:14 - WarehouseSelector
src/features/orders/hooks/useAllocations.ts:184 - useUpdateOrderLineStatus
src/features/orders/hooks/useAllocations.ts:197 - useReMatchOrder
src/features/orders/hooks/useMasters.ts:9 - useMasters
src/features/orders/hooks/useOrders.ts:27 - useOrdersWithAllocations
src/features/orders/hooks/useOrders.ts:40 - useOrderDetail
src/features/orders/hooks/useOrders.ts:8 - queryKeys (used in module)
src/features/orders/hooks/useOrders.ts:21 - useOrders
src/features/orders/components/OrderLineCard/index.tsx:27 - OrderLineCard (used in module)
src/features/orders/components/OrderLineCard/index.tsx:209 - default


===== knip (frontend) =====

Unused files (61)
src/@types/aliases.ts                                     
src/components/common/InfoRow.tsx                         
src/components/DashboardStats.tsx                         
src/components/shared/CommonUI.tsx                        
src/components/shared/data/EmptyState.tsx                 
src/components/shared/data/index.ts                       
src/components/shared/ErrorBoundary.tsx                   
src/components/shared/index.ts                            
src/components/ui/badge.tsx                               
src/components/ui/icons.tsx                               
src/components/ui/progress.tsx                            
src/components/ui/StatCard.tsx                            
src/components/ui/table.tsx                               
src/components/WarehouseAllocationModal.tsx               
src/factories/index.ts                                    
src/factories/lot-factory.ts                              
src/factories/master-factory.ts                           
src/factories/order-factory.ts                            
src/features/forecast/api.ts                              
src/features/masters/api.ts                               
src/features/orders/components/AllocationProgress.tsx     
src/features/orders/components/ForecastSection-v2.tsx     
src/features/orders/components/ForecastSection.tsx        
src/features/orders/components/LotAllocationPanel.tsx     
src/features/orders/components/LotListWithAllocation.tsx  
src/features/orders/components/OrderCard.tsx              
src/features/orders/components/OrderFilters.tsx           
src/features/orders/components/OrderLineCard/index.tsx    
src/features/orders/components/OrderLineHeader.tsx        
src/features/orders/components/WarehouseBadges.tsx        
src/features/orders/components/WarehouseSelector.tsx      
src/features/orders/hooks/useAllocationActions.ts         
src/features/orders/hooks/useAllocations.ts               
src/features/orders/hooks/useMasters.ts                   
src/features/orders/hooks/useOrderLineComputed.ts         
src/features/orders/hooks/useOrders.ts                    
src/features/orders/OrdersPage.tsx                        
src/hooks/api/useForecastQuery.ts                         
src/hooks/use-toast.ts                                    
src/hooks/useDragAssign.ts                                
src/hooks/useForecasts.ts                                 
src/hooks/useLots.ts                                      
src/hooks/useOrderQuery.ts                                
src/hooks/useOrders.ts                                    
src/lib/admin-api.ts                                      
src/lib/api-client.ts                                     
src/lib/api.ts                                            
src/lib/apiClient.ts                                      
src/lib/csv.ts                                            
src/lib/query.ts                                          
src/lib/utils/date.ts                                     
src/mocks/browser.ts                                      
src/mocks/handlers/index.ts                               
src/mocks/handlers/lot-handlers.ts                        
src/mocks/handlers/order-handlers.ts                      
src/pages/OrderDetailPage.tsx                             
src/pages/OrderPage.tsx                                   
src/pages/OrdersPage.tsx                                  
src/services/api/index.ts                                 
src/types/forecast.ts                                     
src/types/legacy/index.ts                                 
Unused dependencies (6)
@hookform/resolvers       package.json:20:6
@radix-ui/react-progress  package.json:24:6
react-error-boundary      package.json:36:6
react-hook-form           package.json:37:6
tailwindcss-animate       package.json:40:6
ts-pattern                package.json:41:6
Unused devDependencies (7)
@faker-js/faker                   package.json:45:6
@tanstack/react-table             package.json:47:6
@typescript-eslint/eslint-plugin  package.json:51:6
@typescript-eslint/parser         package.json:52:6
autoprefixer                      package.json:54:6
msw                               package.json:60:6
postcss                           package.json:62:6
Unlisted dependencies (1)
@eslint/js  eslint.config.js:2:16
Unused exports (115)
TextFilterField                 function  src/components/shared/data/FilterField.tsx:93:17     
SelectFilterField               function  src/components/shared/data/FilterField.tsx:136:17    
DateFilterField                 function  src/components/shared/data/FilterField.tsx:181:17    
DateRangeFilterField            function  src/components/shared/data/FilterField.tsx:222:17    
CheckboxFilterField             function  src/components/shared/data/FilterField.tsx:273:17    
NumberRangeFilterField          function  src/components/shared/data/FilterField.tsx:324:17    
CompactFilterPanel              function  src/components/shared/data/FilterPanel.tsx:97:17     
InlineFilterPanel               function  src/components/shared/data/FilterPanel.tsx:130:17    
InstantSearchBar                function  src/components/shared/data/SearchBar.tsx:127:17      
StatusBadge                     function  src/components/shared/data/StatusBadge.tsx:54:17     
SimplePagination                function  src/components/shared/data/TablePagination.tsx:190:17
ConfirmDialog                   function  src/components/shared/form/FormDialog.tsx:152:17     
TextFormField                   function  src/components/shared/form/FormField.tsx:59:17       
TextareaFormField               function  src/components/shared/form/FormField.tsx:112:17      
SelectFormField                 function  src/components/shared/form/FormField.tsx:170:17      
DateFormField                   function  src/components/shared/form/FormField.tsx:222:17      
NumberFormField                 function  src/components/shared/form/FormField.tsx:276:17      
buttonVariants                            src/components/ui/button.tsx:49:17                   
DialogPortal                              src/components/ui/dialog.tsx:92:10                   
DialogOverlay                             src/components/ui/dialog.tsx:93:16                   
DialogClose                               src/components/ui/dialog.tsx:94:17                   
DialogTrigger                             src/components/ui/dialog.tsx:95:15                   
SelectGroup                               src/components/ui/select.tsx:148:10                  
SelectLabel                               src/components/ui/select.tsx:152:17                  
SelectSeparator                           src/components/ui/select.tsx:154:14                  
SelectScrollUpButton                      src/components/ui/select.tsx:155:19                  
SelectScrollDownButton                    src/components/ui/select.tsx:156:24                  
getLot                                    src/features/inventory/api.ts:41:14                  
createLot                                 src/features/inventory/api.ts:46:14                  
reMatchOrder                              src/features/orders/api.ts:49:14                     
getOrdersWithAllocations                  src/features/orders/api.ts:57:14                     
getWarehouseAllocList                     src/features/orders/api.ts:65:14                     
getCandidateLots                          src/features/orders/api.ts:73:14                     
createLotAllocations                      src/features/orders/api.ts:93:14                     
cancelLotAllocations                      src/features/orders/api.ts:109:14                    
saveWarehouseAllocations                  src/features/orders/api.ts:121:14                    
updateOrderLineStatus                     src/features/orders/api.ts:142:14                    
useProductsQuery                function  src/hooks/api/useMastersQuery.ts:24:17               
useCustomersQuery               function  src/hooks/api/useMastersQuery.ts:47:17               
useWarehousesQuery              function  src/hooks/api/useMastersQuery.ts:70:17               
useProductQuery                 function  src/hooks/api/useMastersQuery.ts:88:17               
useCustomerQuery                function  src/hooks/api/useMastersQuery.ts:108:17              
useWarehouseQuery               function  src/hooks/api/useMastersQuery.ts:128:17              
useAllMastersQuery              function  src/hooks/api/useMastersQuery.ts:158:17              
createSelectOptions             function  src/hooks/api/useMastersQuery.ts:176:17              
useProductOptions               function  src/hooks/api/useMastersQuery.ts:192:17              
useCustomerOptions              function  src/hooks/api/useMastersQuery.ts:208:17              
useWarehouseOptions             function  src/hooks/api/useMastersQuery.ts:221:17              
useCreateAllocations            function  src/hooks/mutations/useAllocationMutations.ts:38:17  
useCancelAllocation             function  src/hooks/mutations/useAllocationMutations.ts:95:17  
useBulkCancelAllocations        function  src/hooks/mutations/useAllocationMutations.ts:126:17 
useCancelAllAllocationsForLine  function  src/hooks/mutations/useAllocationMutations.ts:164:17 
useAutoAllocate                 function  src/hooks/mutations/useAllocationMutations.ts:218:17 
useUpdateLot                    function  src/hooks/mutations/useLotMutations.ts:69:17         
useDeleteLot                    function  src/hooks/mutations/useLotMutations.ts:114:17        
useBulkCreateLots               function  src/hooks/mutations/useLotMutations.ts:145:17        
useUpdateLotStatus              function  src/hooks/mutations/useLotMutations.ts:187:17        
useUpdateOrder                  function  src/hooks/mutations/useOrderMutations.ts:70:17       
useDeleteOrder                  function  src/hooks/mutations/useOrderMutations.ts:115:17      
useUpdateOrderStatus            function  src/hooks/mutations/useOrderMutations.ts:161:17      
useBulkCreateOrders             function  src/hooks/mutations/useOrderMutations.ts:192:17      
useDialogWithData               function  src/hooks/ui/useDialog.ts:72:17                      
useConfirmDialog                function  src/hooks/ui/useDialog.ts:128:17                     
useMultipleDialogs              function  src/hooks/ui/useDialog.ts:200:17                     
useSearchFilter                 function  src/hooks/ui/useFilters.ts:119:17                    
useDateRangeFilter              function  src/hooks/ui/useFilters.ts:178:17                    
filterData                      function  src/hooks/ui/useFilters.ts:223:17                    
searchData                      function  src/hooks/ui/useFilters.ts:245:17                    
useSelection                    function  src/hooks/ui/useTable.ts:229:17                      
useSingleToast                  function  src/hooks/ui/useToast.ts:144:17                      
usePromiseToast                 function  src/hooks/ui/useToast.ts:229:17                      
toApiUrl                        function  src/lib/http.ts:18:17                                
API_BASE                                  src/lib/http.ts:94:14                                
axiosClient                               src/lib/http.ts:95:14                                
getStats                        function  src/services/api.ts:101:23                           
getOrdersWithAllocations        function  src/services/api.ts:109:23                           
reMatchOrder                    function  src/services/api.ts:114:23                           
listLots                        function  src/services/api/lot-service.ts:15:23                
getLotById                      function  src/services/api/lot-service.ts:23:23                
listLotsWithStock               function  src/services/api/lot-service.ts:54:23                
listLotsByProduct               function  src/services/api/lot-service.ts:63:23                
listLotsBySupplier              function  src/services/api/lot-service.ts:70:23                
listSuppliers                   function  src/services/api/master-service.ts:27:23             
listAllMasters                  function  src/services/api/master-service.ts:52:23             
listOrders                      function  src/services/api/order-service.ts:15:23              
getOrderById                    function  src/services/api/order-service.ts:23:23              
updateOrderStatus               function  src/services/api/order-service.ts:39:23              
listOrdersByStatus              function  src/services/api/order-service.ts:60:23              
listPendingOrders               function  src/services/api/order-service.ts:67:23              
listAllocatedOrders             function  src/services/api/order-service.ts:74:23              
listShippedOrders               function  src/services/api/order-service.ts:81:23              
listOrdersByCustomer            function  src/services/api/order-service.ts:88:23              
getOrderDetail                  function  src/services/api/order-service.ts:91:23              
lotKeys                                   src/services/api/query-keys.ts:26:14                 
orderKeys                                 src/services/api/query-keys.ts:41:14                 
masterKeys                                src/services/api/query-keys.ts:58:14                 
allQueryKeys                              src/services/api/query-keys.ts:83:14                 
get                             function  src/services/http.ts:64:23                           
post                            function  src/services/http.ts:71:23                           
put                             function  src/services/http.ts:82:23                           
patch                           function  src/services/http.ts:93:23                           
del                             function  src/services/http.ts:104:23                          
default                                   src/services/http.ts:112:8                           
ValidationError                 class     src/utils/errors/custom-errors.ts:25:14              
AuthenticationError             class     src/utils/errors/custom-errors.ts:36:14              
AuthorizationError              class     src/utils/errors/custom-errors.ts:47:14              
NotFoundError                   class     src/utils/errors/custom-errors.ts:58:14              
ServerError                     class     src/utils/errors/custom-errors.ts:69:14              
lotCreateSchema                           src/utils/validators/lot-schemas.ts:11:14            
lotUpdateSchema                           src/utils/validators/lot-schemas.ts:30:14            
lotSearchSchema                           src/utils/validators/lot-schemas.ts:42:14            
productSchema                             src/utils/validators/master-schemas.ts:11:14         
supplierSchema                            src/utils/validators/master-schemas.ts:21:14         
warehouseSchema                           src/utils/validators/master-schemas.ts:32:14         
customerSchema                            src/utils/validators/master-schemas.ts:42:14         
Unused exported types (74)
SortConfig                   interface  src/components/shared/data/DataTable.tsx:42:18                  
DataTableProps               interface  src/components/shared/data/DataTable.tsx:47:18                  
FilterFieldProps             interface  src/components/shared/data/FilterField.tsx:29:18                
SelectOption                 interface  src/components/shared/data/FilterField.tsx:69:18                
TextFilterFieldProps         interface  src/components/shared/data/FilterField.tsx:78:18                
SelectFilterFieldProps       interface  src/components/shared/data/FilterField.tsx:119:18               
DateFilterFieldProps         interface  src/components/shared/data/FilterField.tsx:168:18               
DateRangeFilterFieldProps    interface  src/components/shared/data/FilterField.tsx:205:18               
CheckboxFilterFieldProps     interface  src/components/shared/data/FilterField.tsx:258:18               
NumberRangeFilterFieldProps  interface  src/components/shared/data/FilterField.tsx:307:18               
FilterPanelProps             interface  src/components/shared/data/FilterPanel.tsx:20:18                
CompactFilterPanelProps      interface  src/components/shared/data/FilterPanel.tsx:84:18                
InlineFilterPanelProps       interface  src/components/shared/data/FilterPanel.tsx:117:18               
SearchBarProps               interface  src/components/shared/data/SearchBar.tsx:21:18                  
InstantSearchBarProps        interface  src/components/shared/data/SearchBar.tsx:110:18                 
StatusBadgeProps             interface  src/components/shared/data/StatusBadge.tsx:38:18                
LotStatus                    type       src/components/shared/data/StatusBadge.tsx:66:13                
LotStatusBadgeProps          interface  src/components/shared/data/StatusBadge.tsx:96:18                
OrderStatus                  type       src/components/shared/data/StatusBadge.tsx:127:13               
OrderStatusBadgeProps        interface  src/components/shared/data/StatusBadge.tsx:172:18               
TablePaginationProps         interface  src/components/shared/data/TablePagination.tsx:26:18            
SimplePaginationProps        interface  src/components/shared/data/TablePagination.tsx:175:18           
FormDialogProps              interface  src/components/shared/form/FormDialog.tsx:27:18                 
ConfirmDialogProps           interface  src/components/shared/form/FormDialog.tsx:127:18                
BaseFormFieldProps           interface  src/components/shared/form/FormField.tsx:27:18                  
TextFormFieldProps           interface  src/components/shared/form/FormField.tsx:46:18                  
TextareaFormFieldProps       interface  src/components/shared/form/FormField.tsx:99:18                  
SelectOption                 interface  src/components/shared/form/FormField.tsx:152:18                 
SelectFormFieldProps         interface  src/components/shared/form/FormField.tsx:157:18                 
DateFormFieldProps           interface  src/components/shared/form/FormField.tsx:213:18                 
NumberFormFieldProps         interface  src/components/shared/form/FormField.tsx:259:18                 
ButtonProps                  interface  src/components/ui/button.tsx:33:18                              
TextareaProps                type       src/components/ui/textarea.tsx:11:13                            
AllocationInputItem          type       src/features/allocations/api.ts:5:13                            
ForecastFileUploadCardProps  type       src/features/forecast/components/ForecastFileUploadCard.tsx:8:13
OrdersListParams             type       src/features/orders/api.ts:12:13                                
OrderResponse                type       src/features/orders/api.ts:13:13                                
OrderWithLinesResponse       type       src/features/orders/api.ts:14:13                                
FilterValue                  type       src/hooks/ui/useFilters.ts:12:13                                
FilterState                  type       src/hooks/ui/useFilters.ts:17:13                                
SortDirection                type       src/hooks/ui/useTable.ts:12:13                                  
SortState                    interface  src/hooks/ui/useTable.ts:17:18                                  
PaginationState              interface  src/hooks/ui/useTable.ts:25:18                                  
ToastVariant                 type       src/hooks/ui/useToast.ts:12:13                                  
Toast                        interface  src/hooks/ui/useToast.ts:17:18                                  
Order                        type       src/services/api.ts:93:14                                       
OrderDetail                  type       src/services/api.ts:93:21                                       
DragAssignRequest            type       src/services/api.ts:93:34                                       
DragAssignResponse           type       src/services/api.ts:93:53                                       
Lot                          type       src/services/api.ts:93:73                                       
ForecastResponse             type       src/services/api.ts:93:78                                       
DashboardStats               type       src/services/api.ts:96:13                                       
Product                      type       src/types/aliases.ts:3:13                                       
Supplier                     type       src/types/aliases.ts:13:13                                      
Customer                     type       src/types/aliases.ts:19:13                                      
Warehouse                    type       src/types/aliases.ts:24:13                                      
OldWarehouse                 type       src/types/aliases.ts:30:13                                      
LotCreate                    type       src/types/aliases.ts:49:13                                      
LotWithStock                 type       src/types/aliases.ts:50:13                                      
LotCandidateResponse         type       src/types/aliases.ts:77:13                                      
WarehouseAlloc               type       src/types/aliases.ts:79:13                                      
LotAllocationRequest         type       src/types/aliases.ts:88:13                                      
AllocationCancelRequest      type       src/types/aliases.ts:91:13                                      
OrderLineComputed            type       src/types/aliases.ts:126:13                                     
OrderLineCreate              type       src/types/aliases.ts:152:13                                     
FefoLotAllocation            type       src/types/aliases.ts:162:13                                     
getLotCandidates             type       src/types/aliases.ts:178:13                                     
LotCreate                    type       src/utils/validators/lot-schemas.ts:53:13                       
LotUpdate                    type       src/utils/validators/lot-schemas.ts:63:13                       
LotWithStock                 type       src/utils/validators/lot-schemas.ts:65:13                       
ProductInput                 type       src/utils/validators/master-schemas.ts:84:13                    
SupplierInput                type       src/utils/validators/master-schemas.ts:85:13                    
WarehouseInput               type       src/utils/validators/master-schemas.ts:86:13                    
CustomerInput                type       src/utils/validators/master-schemas.ts:87:13                    
Duplicate exports (1)
http|default  src/services/http.ts
Configuration hints (1)
. (root)      Create knip.json configuration file, and add entry and/or refine project files (61 unused files)


===== depcheck (frontend) =====

Unused dependencies
* @hookform/resolvers
* react-error-boundary
* react-hook-form
* tailwindcss-animate
* ts-pattern
Unused devDependencies
* @tanstack/react-table
* @typescript-eslint/eslint-plugin
* @typescript-eslint/parser
* autoprefixer
* postcss
* tailwindcss
* typedoc-plugin-markdown
Missing dependencies
* @eslint/js: ./eslint.config.js


===== madge --json (frontend) =====

{}

